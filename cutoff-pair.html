<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Force constants calculation with cutoff pair-distance &#8212; Phono3py v.1.22.3</title>
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Output files" href="output-files.html" />
    <link rel="prev" title="Command options / Setting tags" href="command-options.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="_static/js/jquery-1.12.4.min.js "></script>
<script type="text/javascript" src="_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="_static/bootstrap-3.4.1/js/bootstrap.min.js "></script>
<script type="text/javascript" src="_static/bootstrap-sphinx.js "></script>

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html">
          Phono3py</a>
        <span class="navbar-text navbar-version pull-left"><b>1.22</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="install.html#installation-using-conda">Installation using conda</a></li>
<li class="toctree-l2"><a class="reference internal" href="install.html#installation-using-pip-is-not-recommended">Installation using pip is not recommended</a></li>
<li class="toctree-l2"><a class="reference internal" href="install.html#installation-from-source-code">Installation from source code</a></li>
<li class="toctree-l2"><a class="reference internal" href="install.html#installation-instruction-of-latest-development-version-of-phono3py">Installation instruction of latest development version of phono3py</a></li>
<li class="toctree-l2"><a class="reference internal" href="install.html#multithreading-and-its-controlling-by-c-macro">Multithreading and its controlling by C macro</a></li>
<li class="toctree-l2"><a class="reference internal" href="install.html#trouble-shooting">Trouble shooting</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="interfaces.html">Interfaces to calculators (VASP, QE, CRYSTAL, Abinit, TURBOMOLE)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="vasp.html">VASP &amp; phono3py calculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="qe.html">Quantum ESPRESSO (pw) &amp; phono3py calculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="crystal.html">CRYSTAL &amp; phono3py calculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="turbomole.html">TURBOMOLE &amp; phono3py calculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="interfaces.html#calculator-specific-behaviors">Calculator specific behaviors</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="command-options.html">Command options / Setting tags</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="command-options.html#input-cell-file-name">Input cell file name</a></li>
<li class="toctree-l2"><a class="reference internal" href="command-options.html#calculator-interface">Calculator interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="command-options.html#utilities-to-create-default-input-files">Utilities to create default input files</a></li>
<li class="toctree-l2"><a class="reference internal" href="command-options.html#supercell-and-primitive-cell">Supercell and primitive cell</a></li>
<li class="toctree-l2"><a class="reference internal" href="command-options.html#displacement-creation">Displacement creation</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="command-options.html#force-constants">Force constants</a></li>
<li class="toctree-l2"><a class="reference internal" href="command-options.html#reciprocal-space-sampling-mesh-and-grid-points-and-band-indices">Reciprocal space sampling mesh and grid points, and band indices</a></li>
<li class="toctree-l2"><a class="reference internal" href="command-options.html#brillouin-zone-integration">Brillouin zone integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="command-options.html#method-to-solve-bte">Method to solve BTE</a></li>
<li class="toctree-l2"><a class="reference internal" href="command-options.html#scattering">Scattering</a></li>
<li class="toctree-l2"><a class="reference internal" href="command-options.html#temperature">Temperature</a></li>
<li class="toctree-l2"><a class="reference internal" href="command-options.html#non-analytical-term-correction">Non-analytical term correction</a></li>
<li class="toctree-l2"><a class="reference internal" href="command-options.html#imaginary-part-of-self-energy">Imaginary part of self energy</a></li>
<li class="toctree-l2"><a class="reference internal" href="command-options.html#joint-density-of-states">Joint density of states</a></li>
<li class="toctree-l2"><a class="reference internal" href="command-options.html#sampling-frequency-for-distribution-functions">Sampling frequency for distribution functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="command-options.html#mode-gruneisen-parameter-from-3rd-order-force-constants">Mode-Gruneisen parameter from 3rd order force constants</a></li>
<li class="toctree-l2"><a class="reference internal" href="command-options.html#file-i-o">File I/O</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="output-files.html">Output files</a><ul>
<li class="toctree-l2"><a class="reference internal" href="output-files.html#intermediate-text-files">Intermediate text files</a></li>
<li class="toctree-l2"><a class="reference internal" href="output-files.html#hdf5-files">HDF5 files</a></li>
<li class="toctree-l2"><a class="reference internal" href="output-files.html#simple-text-file">Simple text file</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="hdf5_howto.html">How to read the results stored in hdf5 files</a><ul>
<li class="toctree-l2"><a class="reference internal" href="hdf5_howto.html#how-to-use-hdf5-python-library">How to use HDF5 python library</a></li>
<li class="toctree-l2"><a class="reference internal" href="hdf5_howto.html#details-of-kappa-hdf5-file">Details of <code class="docutils literal notranslate"><span class="pre">kappa-*.hdf5</span></code> file</a></li>
<li class="toctree-l2"><a class="reference internal" href="hdf5_howto.html#how-to-know-grid-point-number-corresponding-to-grid-address">How to know grid point number corresponding to grid address</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="auxiliary-tools.html">Auxiliary tools</a><ul>
<li class="toctree-l2"><a class="reference internal" href="auxiliary-tools.html#phono3py-kaccum"><code class="docutils literal notranslate"><span class="pre">phono3py-kaccum</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="auxiliary-tools.html#phono3py-kdeplot"><code class="docutils literal notranslate"><span class="pre">phono3py-kdeplot</span></code></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="direct-solution.html">Direct solution of linearized phonon Boltzmann equation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="direct-solution.html#how-to-use">How to use</a></li>
<li class="toctree-l2"><a class="reference internal" href="direct-solution.html#memory-usage">Memory usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="direct-solution.html#work-load-distribution">Work load distribution</a></li>
<li class="toctree-l2"><a class="reference internal" href="direct-solution.html#cutoff-parameter-of-pseudo-inversion">Cutoff parameter of pseudo inversion</a></li>
<li class="toctree-l2"><a class="reference internal" href="direct-solution.html#installation-of-diagonalization-solvers-with-multithreaded-blas">Installation of diagonalization solvers with multithreaded BLAS</a></li>
<li class="toctree-l2"><a class="reference internal" href="direct-solution.html#solver-choice-for-diagonalization">Solver choice for diagonalization</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="workload-distribution.html">Workload distribution</a><ul>
<li class="toctree-l2"><a class="reference internal" href="workload-distribution.html#how-to-do-it">How to do it</a></li>
<li class="toctree-l2"><a class="reference internal" href="workload-distribution.html#a-convenient-script">A convenient script</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Force constants calculation with cutoff pair-distance</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#what-is-cutff-pair-distance-in-phono3py">What is cutff pair-distance in phono3py?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#usage">Usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="#a-script-extract-supercell-ids-from-disp-fc3-yaml">A script extract supercell IDs from <code class="docutils literal notranslate"><span class="pre">disp_fc3.yaml</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-test">The Test</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="external-tools.html">External tools</a><ul>
<li class="toctree-l2"><a class="reference internal" href="external-tools.html#phono3py-power-tools">Phono3py-Power-Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="external-tools.html#kinetic-collective-model">Kinetic Collective Model</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="tips.html">Tips</a><ul>
<li class="toctree-l2"><a class="reference internal" href="tips.html#brillouin-zone-summation">Brillouin zone summation</a></li>
<li class="toctree-l2"><a class="reference internal" href="tips.html#importance-of-numerical-quality-of-force-constants">Importance of numerical quality of force constants</a></li>
<li class="toctree-l2"><a class="reference internal" href="tips.html#file-format-compatibility-with-phonopy">File format compatibility with phonopy</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="citation.html">How to cite phono3py</a><ul>
<li class="toctree-l2"><a class="reference internal" href="citation.html#citation-of-phono3py">Citation of phono3py</a></li>
<li class="toctree-l2"><a class="reference internal" href="citation.html#citation-of-direct-solution-of-lbte-lbte">Citation of direct solution of LBTE (<code class="docutils literal notranslate"><span class="pre">--lbte</span></code>)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Change Log</a><ul>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#mar-17-2021-version-1-22-3">Mar-17-2021: Version 1.22.3</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#feb-21-2021-version-1-22-2">Feb-21-2021: Version 1.22.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#feb-21-2021-version-1-22-1">Feb-21-2021: Version 1.22.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#jan-29-2021-version-1-22-0">Jan-29-2021: Version 1.22.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#sep-30-2020-version-1-21-0">Sep-30-2020: Version 1.21.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#mar-3-2020-version-1-20-0">Mar-3-2020: Version 1.20.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#mar-3-2020-version-1-19-1">Mar-3-2020: Version 1.19.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#mar-2-2020-version-1-19-0">Mar-2-2020: Version 1.19.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#dec-22-2019-version-1-18-2">Dec-22-2019: Version 1.18.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#oct-17-2019-version-1-18-1">Oct-17-2019: Version 1.18.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#oct-9-2019-version-1-18-0">Oct-9-2019: Version 1.18.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#apr-18-2019-version-1-17-0">Apr-18-2019: Version 1.17.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#mar-24-2019-version-1-16-0">Mar-24-2019: Version 1.16.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#nov-22-2018-version-1-14-3">Nov-22-2018: version 1.14.3</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#june-20-2018-version-1-13-3">June-20-2018: version 1.13.3</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#may-17-2018-version-1-13-1">May-17-2018: version 1.13.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#mar-16-2018-version-1-12-9">Mar-16-2018: version 1.12.9</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#feb-1-2018-version-1-12-7">Feb-1-2018: version 1.12.7</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#nov-22-2017-version-1-12-5">Nov-22-2017: version 1.12.5</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#nov-17-2017-version-1-12-3">Nov-17-2017: version 1.12.3</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#jun-18-2017-version-1-11-13">Jun-18-2017: version 1.11.13</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#mar-31-2017-version-1-11-11">Mar-31-2017: version 1.11.11</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#feb-9-2017-version-1-11-9">Feb-9-2017: version 1.11.9</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#dec-14-2016-version-1-11-7">Dec-14-2016: version 1.11.7</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#nov-27-2016-version-1-11-5">Nov-27-2016: version 1.11.5</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#apr-24-2016-version-1-10-9">Apr-24-2016: version 1.10.9</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#apr-16-2016-version-1-10-7">Apr-16-2016: version 1.10.7</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#mar-15-2016-version-1-10-5">Mar-15-2016: version 1.10.5</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#oct-10-2015-version-0-9-14">Oct-10-2015: version 0.9.14</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#sep-26-2015-version-0-9-13">Sep-26-2015: version 0.9.13</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#aug-12-2015-version-0-9-12">Aug-12-2015: version 0.9.12</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#jun-18-2015-version-0-9-10-1">Jun-18-2015: version 0.9.10.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#jun-17-2015-version-0-9-10">Jun-17-2015: version 0.9.10</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#changes-in-version-0-9-7">Changes in version 0.9.7</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#changes-in-version-0-9-6">Changes in version 0.9.6</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#changes-in-version-0-9-5">Changes in version 0.9.5</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#changes-in-version-0-9-4">Changes in version 0.9.4</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#changes-in-version-0-8-11">Changes in version 0.8.11</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#changes-in-version-0-8-10">Changes in version 0.8.10</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#changes-in-version-0-8-2">Changes in version 0.8.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#changes-in-version-0-8-0">Changes in version 0.8.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#changes-in-version-0-7-6">Changes in version 0.7.6</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#changes-in-version-0-7-2">Changes in version 0.7.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#changes-in-version-0-7-1">Changes in version 0.7.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#changes-in-version-0-6-0">Changes in version 0.6.0</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Force constants calculation with cutoff pair-distance</a><ul>
<li><a class="reference internal" href="#what-is-cutff-pair-distance-in-phono3py">What is cutff pair-distance in phono3py?</a></li>
<li><a class="reference internal" href="#usage">Usage</a><ul>
<li><a class="reference internal" href="#creating-supercells-with-displacements">Creating supercells with displacements</a><ul>
<li><a class="reference internal" href="#supercell-files">Supercell files</a></li>
<li><a class="reference internal" href="#special-disp-fc3-yaml">Special <code class="docutils literal notranslate"><span class="pre">disp_fc3.yaml</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#making-forces-fc3">Making <code class="docutils literal notranslate"><span class="pre">FORCES_FC3</span></code></a></li>
<li><a class="reference internal" href="#running-phonon-phonon-interaction-calculation">Running phonon-phonon interaction calculation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#a-script-extract-supercell-ids-from-disp-fc3-yaml">A script extract supercell IDs from <code class="docutils literal notranslate"><span class="pre">disp_fc3.yaml</span></code></a></li>
<li><a class="reference internal" href="#the-test">The Test</a><ul>
<li><a class="reference internal" href="#si-pbe">Si-PBE</a></li>
<li><a class="reference internal" href="#aln-lda">AlN-LDA</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="command-options.html" title="Previous Chapter: Command options / Setting tags"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Command optio...</span>
    </a>
  </li>
  <li>
    <a href="output-files.html" title="Next Chapter: Output files"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">Output files &raquo;</span>
    </a>
  </li>
              
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <div class="section" id="force-constants-calculation-with-cutoff-pair-distance">
<span id="command-cutoff-pair"></span><h1>Force constants calculation with cutoff pair-distance<a class="headerlink" href="#force-constants-calculation-with-cutoff-pair-distance" title="Permalink to this headline">¶</a></h1>
<p>Here the detail of the command option <a class="reference internal" href="command-options.html#cutoff-pair-option"><span class="std std-ref">–cutoff_pair</span></a> is explained.</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#what-is-cutff-pair-distance-in-phono3py" id="id1">What is cutff pair-distance in phono3py?</a></p></li>
<li><p><a class="reference internal" href="#usage" id="id2">Usage</a></p>
<ul>
<li><p><a class="reference internal" href="#creating-supercells-with-displacements" id="id3">Creating supercells with displacements</a></p></li>
<li><p><a class="reference internal" href="#making-forces-fc3" id="id4">Making <code class="docutils literal notranslate"><span class="pre">FORCES_FC3</span></code></a></p></li>
<li><p><a class="reference internal" href="#running-phonon-phonon-interaction-calculation" id="id5">Running phonon-phonon interaction calculation</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#a-script-extract-supercell-ids-from-disp-fc3-yaml" id="id6">A script extract supercell IDs from <code class="docutils literal notranslate"><span class="pre">disp_fc3.yaml</span></code></a></p></li>
<li><p><a class="reference internal" href="#the-test" id="id7">The Test</a></p>
<ul>
<li><p><a class="reference internal" href="#si-pbe" id="id8">Si-PBE</a></p></li>
<li><p><a class="reference internal" href="#aln-lda" id="id9">AlN-LDA</a></p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="what-is-cutff-pair-distance-in-phono3py">
<h2><a class="toc-backref" href="#id1">What is cutff pair-distance in phono3py?</a><a class="headerlink" href="#what-is-cutff-pair-distance-in-phono3py" title="Permalink to this headline">¶</a></h2>
<p>Using <code class="docutils literal notranslate"><span class="pre">--cutoff-pair</span></code> option, number of supercells with
displacements to be calculated is reduced. But of course this
sacrifices the accuracy of third-order force constants (fc3).</p>
<p>In phono3py, to obtain supercell-fc3,
<span class="math notranslate nohighlight">\(\Phi_{\alpha\beta\gamma}(jl, j'l', j''l'')\)</span>, forces in many
supercells having different pairs of displaced atoms are computed
using some force-calculator such as ab-initio code. In the phono3py
default behaviour, full elements of supercell-fc3 are computed. In
this case, though depending on the number of atoms in the supercell
and the crystal symmetry, the number of atomic-pair configuration can
be huge and beyond our computational resource.</p>
<p>Sometimes we may expect that interaction range of fc3 among triplets
of atoms is shorter than chosen supercell size. If it is the case, we
may be allowed to omit computing some elements of supercell-fc3. This
is what achieved by <code class="docutils literal notranslate"><span class="pre">--cutoff-pair</span></code> option.</p>
<p>A supercell-fc3 element is specified by three atomic
displacements. Two of three are finitely displaced
(<span class="math notranslate nohighlight">\(\Delta\mathbf{r}_1\)</span> and <span class="math notranslate nohighlight">\(\Delta\mathbf{r}_2\)</span>) but one of
them is included in a force given by the force calculator such as
<span class="math notranslate nohighlight">\(\mathbf{F}_3=-\frac{\partial V}{\partial\mathbf{r}_3}\)</span>. The
cutoff distance <span class="math notranslate nohighlight">\(d_\text{cut}\)</span> is defined as the upper bound of
the distance between the atoms 1 and 2. By this, the set of atomic
pairs <span class="math notranslate nohighlight">\(\{(\mathbf{r}_1,\mathbf{r}_2)| |\mathbf{r}_1 -
\mathbf{r}_2| &lt; d_\text{cut}\}\)</span> is selected for the supercell-fc3
calculation. By this, when three distances among the three atoms of
triplets are all larger than <span class="math notranslate nohighlight">\(d_\text{cut}\)</span>, those fc3 elements
can not be obtained and so they are simply set zero.</p>
</div>
<div class="section" id="usage">
<h2><a class="toc-backref" href="#id2">Usage</a><a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<div class="section" id="creating-supercells-with-displacements">
<h3><a class="toc-backref" href="#id3">Creating supercells with displacements</a><a class="headerlink" href="#creating-supercells-with-displacements" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">--cutoff-pair</span></code> option is employed when creating supercells with
displacements, therefore this option must be used with <code class="docutils literal notranslate"><span class="pre">-d</span></code> option
when running phono3py, for example for the Si example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">phono3py</span> <span class="o">--</span><span class="n">cutoff</span><span class="o">-</span><span class="n">pair</span><span class="o">=</span><span class="mi">5</span> <span class="o">-</span><span class="n">d</span> <span class="o">--</span><span class="n">dim</span><span class="o">=</span><span class="s2">&quot;2 2 2&quot;</span> <span class="o">-</span><span class="n">c</span> <span class="n">POSCAR</span><span class="o">-</span><span class="n">unitcell</span>
        <span class="n">_</span>                      <span class="n">_____</span>
  <span class="n">_</span> <span class="n">__</span> <span class="o">|</span> <span class="o">|</span><span class="n">__</span>   <span class="n">___</span>  <span class="n">_</span> <span class="n">__</span>   <span class="n">___</span><span class="o">|</span><span class="n">___</span> <span class="o">/</span> <span class="n">_</span> <span class="n">__</span>  <span class="n">_</span>   <span class="n">_</span>
 <span class="o">|</span> <span class="s1">&#39;_ \| &#39;</span><span class="n">_</span> \ <span class="o">/</span> <span class="n">_</span> \<span class="o">|</span> <span class="s1">&#39;_ \ / _ \ |_ \| &#39;</span><span class="n">_</span> \<span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span>
 <span class="o">|</span> <span class="o">|</span><span class="n">_</span><span class="p">)</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="o">|</span><span class="n">__</span><span class="p">)</span> <span class="o">|</span> <span class="o">|</span><span class="n">_</span><span class="p">)</span> <span class="o">|</span> <span class="o">|</span><span class="n">_</span><span class="o">|</span> <span class="o">|</span>
 <span class="o">|</span> <span class="o">.</span><span class="n">__</span><span class="o">/|</span><span class="n">_</span><span class="o">|</span> <span class="o">|</span><span class="n">_</span><span class="o">|</span>\<span class="n">___</span><span class="o">/|</span><span class="n">_</span><span class="o">|</span> <span class="o">|</span><span class="n">_</span><span class="o">|</span>\<span class="n">___</span><span class="o">/</span><span class="n">____</span><span class="o">/|</span> <span class="o">.</span><span class="n">__</span><span class="o">/</span> \<span class="n">__</span><span class="p">,</span> <span class="o">|</span>
 <span class="o">|</span><span class="n">_</span><span class="o">|</span>                                <span class="o">|</span><span class="n">_</span><span class="o">|</span>    <span class="o">|</span><span class="n">___</span><span class="o">/</span>
                                          <span class="mf">1.11</span><span class="o">.</span><span class="mi">11</span>

<span class="n">Run</span> <span class="n">mode</span><span class="p">:</span> <span class="n">displacements</span>

<span class="n">Displacement</span> <span class="n">distance</span><span class="p">:</span> <span class="mf">0.03</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">displacements</span><span class="p">:</span> <span class="mi">111</span>
<span class="n">Cutoff</span> <span class="n">distance</span> <span class="k">for</span> <span class="n">displacements</span><span class="p">:</span> <span class="mf">5.0</span>
<span class="n">Number</span> <span class="n">of</span> <span class="n">displacement</span> <span class="n">supercell</span> <span class="n">files</span> <span class="n">created</span><span class="p">:</span> <span class="mi">51</span>
                 <span class="n">_</span>
   <span class="n">___</span> <span class="n">_</span> <span class="n">__</span>   <span class="n">__</span><span class="o">|</span> <span class="o">|</span>
  <span class="o">/</span> <span class="n">_</span> \ <span class="s1">&#39;_ \ / _` |</span>
 <span class="o">|</span>  <span class="n">__</span><span class="o">/</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="p">(</span><span class="n">_</span><span class="o">|</span> <span class="o">|</span>
  \<span class="n">___</span><span class="o">|</span><span class="n">_</span><span class="o">|</span> <span class="o">|</span><span class="n">_</span><span class="o">|</span>\<span class="n">__</span><span class="p">,</span><span class="n">_</span><span class="o">|</span>

<span class="o">%</span> <span class="n">ls</span> <span class="n">POSCAR</span><span class="o">-</span><span class="mi">0</span><span class="o">*</span>
<span class="n">POSCAR</span><span class="o">-</span><span class="mi">00001</span>  <span class="n">POSCAR</span><span class="o">-</span><span class="mi">00032</span>  <span class="n">POSCAR</span><span class="o">-</span><span class="mi">00043</span>  <span class="n">POSCAR</span><span class="o">-</span><span class="mi">00080</span>  <span class="n">POSCAR</span><span class="o">-</span><span class="mi">00097</span>
<span class="n">POSCAR</span><span class="o">-</span><span class="mi">00002</span>  <span class="n">POSCAR</span><span class="o">-</span><span class="mi">00033</span>  <span class="n">POSCAR</span><span class="o">-</span><span class="mi">00070</span>  <span class="n">POSCAR</span><span class="o">-</span><span class="mi">00081</span>  <span class="n">POSCAR</span><span class="o">-</span><span class="mi">00098</span>
<span class="n">POSCAR</span><span class="o">-</span><span class="mi">00003</span>  <span class="n">POSCAR</span><span class="o">-</span><span class="mi">00034</span>  <span class="n">POSCAR</span><span class="o">-</span><span class="mi">00071</span>  <span class="n">POSCAR</span><span class="o">-</span><span class="mi">00082</span>  <span class="n">POSCAR</span><span class="o">-</span><span class="mi">00099</span>
<span class="n">POSCAR</span><span class="o">-</span><span class="mi">00016</span>  <span class="n">POSCAR</span><span class="o">-</span><span class="mi">00035</span>  <span class="n">POSCAR</span><span class="o">-</span><span class="mi">00072</span>  <span class="n">POSCAR</span><span class="o">-</span><span class="mi">00083</span>  <span class="n">POSCAR</span><span class="o">-</span><span class="mi">00100</span>
<span class="n">POSCAR</span><span class="o">-</span><span class="mi">00017</span>  <span class="n">POSCAR</span><span class="o">-</span><span class="mi">00036</span>  <span class="n">POSCAR</span><span class="o">-</span><span class="mi">00073</span>  <span class="n">POSCAR</span><span class="o">-</span><span class="mi">00084</span>  <span class="n">POSCAR</span><span class="o">-</span><span class="mi">00101</span>
<span class="n">POSCAR</span><span class="o">-</span><span class="mi">00018</span>  <span class="n">POSCAR</span><span class="o">-</span><span class="mi">00037</span>  <span class="n">POSCAR</span><span class="o">-</span><span class="mi">00074</span>  <span class="n">POSCAR</span><span class="o">-</span><span class="mi">00085</span>  <span class="n">POSCAR</span><span class="o">-</span><span class="mi">00102</span>
<span class="n">POSCAR</span><span class="o">-</span><span class="mi">00019</span>  <span class="n">POSCAR</span><span class="o">-</span><span class="mi">00038</span>  <span class="n">POSCAR</span><span class="o">-</span><span class="mi">00075</span>  <span class="n">POSCAR</span><span class="o">-</span><span class="mi">00086</span>  <span class="n">POSCAR</span><span class="o">-</span><span class="mi">00103</span>
<span class="n">POSCAR</span><span class="o">-</span><span class="mi">00024</span>  <span class="n">POSCAR</span><span class="o">-</span><span class="mi">00039</span>  <span class="n">POSCAR</span><span class="o">-</span><span class="mi">00076</span>  <span class="n">POSCAR</span><span class="o">-</span><span class="mi">00087</span>
<span class="n">POSCAR</span><span class="o">-</span><span class="mi">00025</span>  <span class="n">POSCAR</span><span class="o">-</span><span class="mi">00040</span>  <span class="n">POSCAR</span><span class="o">-</span><span class="mi">00077</span>  <span class="n">POSCAR</span><span class="o">-</span><span class="mi">00088</span>
<span class="n">POSCAR</span><span class="o">-</span><span class="mi">00026</span>  <span class="n">POSCAR</span><span class="o">-</span><span class="mi">00041</span>  <span class="n">POSCAR</span><span class="o">-</span><span class="mi">00078</span>  <span class="n">POSCAR</span><span class="o">-</span><span class="mi">00089</span>
<span class="n">POSCAR</span><span class="o">-</span><span class="mi">00027</span>  <span class="n">POSCAR</span><span class="o">-</span><span class="mi">00042</span>  <span class="n">POSCAR</span><span class="o">-</span><span class="mi">00079</span>  <span class="n">POSCAR</span><span class="o">-</span><span class="mi">00096</span>
<span class="o">%</span> <span class="n">ls</span> <span class="n">POSCAR</span><span class="o">-</span><span class="mi">0</span><span class="o">*|</span><span class="n">wc</span> <span class="o">-</span><span class="n">l</span>
      <span class="mi">51</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">Number</span> <span class="pre">of</span> <span class="pre">displacements:</span> <span class="pre">111</span></code> shows the number of supercells with
displacements when this is run without <code class="docutils literal notranslate"><span class="pre">--cutoff-pair</span></code>
option. <code class="docutils literal notranslate"><span class="pre">Number</span> <span class="pre">of</span> <span class="pre">displacement</span> <span class="pre">supercell</span> <span class="pre">files</span> <span class="pre">created:</span> <span class="pre">51</span></code> gives
the contracted number of supercells with displacements by
<code class="docutils literal notranslate"><span class="pre">--cutoff-pair</span></code> option. There number of <code class="docutils literal notranslate"><span class="pre">POSCAR-0xxxx</span></code> files is found
51. At this step, a special <code class="docutils literal notranslate"><span class="pre">disp_fc3.yaml</span></code> is created. This
contains information on this contraction and used in the other
calculation step, therefore this file must be kept carefully.</p>
<div class="section" id="supercell-files">
<h4>Supercell files<a class="headerlink" href="#supercell-files" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">POSCAR-xxxxx</span></code> (in the other calculator interface, the prefix of the
filename is different) are not generated if distance between a pair of
atoms to be displaced is larger than the specified cutoff pair
distance. The indexing number (<code class="docutils literal notranslate"><span class="pre">xxxxx</span></code>) corresponds to that of the
case without setting this option, i.e., the same <code class="docutils literal notranslate"><span class="pre">POSCAR-xxxxx</span></code>
files are created for the same configurations of pairs of
displacements but <code class="docutils literal notranslate"><span class="pre">POSCAR-xxxxx</span></code> files not being included are not
generated. The reason of this indexing is that it can be useful when
changing the cutoff-pair-distance.</p>
</div>
<div class="section" id="special-disp-fc3-yaml">
<h4>Special <code class="docutils literal notranslate"><span class="pre">disp_fc3.yaml</span></code><a class="headerlink" href="#special-disp-fc3-yaml" title="Permalink to this headline">¶</a></h4>
<p>Using <code class="docutils literal notranslate"><span class="pre">--cutoff-pair</span></code> option together with <code class="docutils literal notranslate"><span class="pre">-d</span></code> option, a special
<code class="docutils literal notranslate"><span class="pre">disp_fc3.yaml</span></code> is created. This contains information on distances
between displaced atomic-pairs and whether those pairs are to be
computed or not. This special <code class="docutils literal notranslate"><span class="pre">disp_fc3.yaml</span></code> is necessary to create
fc3, therefore be careful not to overwrite it by running the option
<code class="docutils literal notranslate"><span class="pre">-d</span></code> without <code class="docutils literal notranslate"><span class="pre">--cutoff-pair</span></code> or with different <code class="docutils literal notranslate"><span class="pre">--cutoff-pair</span></code>
with different value.</p>
</div>
</div>
<div class="section" id="making-forces-fc3">
<h3><a class="toc-backref" href="#id4">Making <code class="docutils literal notranslate"><span class="pre">FORCES_FC3</span></code></a><a class="headerlink" href="#making-forces-fc3" title="Permalink to this headline">¶</a></h3>
<p>To create <code class="docutils literal notranslate"><span class="pre">FORCES_FC3</span></code>, only output files of the supercells created
using <code class="docutils literal notranslate"><span class="pre">--cutoff-pair</span></code> option are passed to <code class="docutils literal notranslate"><span class="pre">phono3py</span></code> as the
arguments. The special <code class="docutils literal notranslate"><span class="pre">disp_fc3.yaml</span></code> file is necessary to be
located at current directory.</p>
<p>An example is shown below for the Si example. Here, it is supposed
that forces are calculated using VASP in <code class="docutils literal notranslate"><span class="pre">disp-xxxxx</span></code>
directories. After running force calculations, there should be the
output file containing forces in each directory (for VASP
<code class="docutils literal notranslate"><span class="pre">vasprun.xml</span></code>).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">phono3py</span> <span class="o">--</span><span class="n">cf3</span> <span class="n">disp</span><span class="o">-</span><span class="p">{</span><span class="mi">00001</span><span class="p">,</span><span class="mi">00002</span><span class="p">,</span><span class="mi">00003</span><span class="p">,</span><span class="mi">00016</span><span class="p">,</span><span class="mi">00017</span><span class="p">,</span><span class="mi">00018</span><span class="p">,</span><span class="mi">00019</span><span class="p">,</span><span class="mi">00024</span><span class="p">,</span><span class="mi">00025</span><span class="p">,</span><span class="mi">00026</span><span class="p">,</span><span class="mi">00027</span><span class="p">,</span><span class="mi">00032</span><span class="p">,</span><span class="mi">00033</span><span class="p">,</span><span class="mi">00034</span><span class="p">,</span><span class="mi">00035</span><span class="p">,</span><span class="mi">00036</span><span class="p">,</span><span class="mi">00037</span><span class="p">,</span><span class="mi">00038</span><span class="p">,</span><span class="mi">00039</span><span class="p">,</span><span class="mi">00040</span><span class="p">,</span><span class="mi">00041</span><span class="p">,</span><span class="mi">00042</span><span class="p">,</span><span class="mi">00043</span><span class="p">,</span><span class="mi">00070</span><span class="p">,</span><span class="mi">00071</span><span class="p">,</span><span class="mi">00072</span><span class="p">,</span><span class="mi">00073</span><span class="p">,</span><span class="mi">00074</span><span class="p">,</span><span class="mi">00075</span><span class="p">,</span><span class="mi">00076</span><span class="p">,</span><span class="mi">00077</span><span class="p">,</span><span class="mi">00078</span><span class="p">,</span><span class="mi">00079</span><span class="p">,</span><span class="mi">00080</span><span class="p">,</span><span class="mi">00081</span><span class="p">,</span><span class="mi">00082</span><span class="p">,</span><span class="mi">00083</span><span class="p">,</span><span class="mi">00084</span><span class="p">,</span><span class="mi">00085</span><span class="p">,</span><span class="mi">00086</span><span class="p">,</span><span class="mi">00087</span><span class="p">,</span><span class="mi">00088</span><span class="p">,</span><span class="mi">00089</span><span class="p">,</span><span class="mi">00096</span><span class="p">,</span><span class="mi">00097</span><span class="p">,</span><span class="mi">00098</span><span class="p">,</span><span class="mi">00099</span><span class="p">,</span><span class="mi">00100</span><span class="p">,</span><span class="mi">00101</span><span class="p">,</span><span class="mi">00102</span><span class="p">,</span><span class="mi">00103</span><span class="p">}</span><span class="o">/</span><span class="n">vasprun</span><span class="o">.</span><span class="n">xml</span>
        <span class="n">_</span>                      <span class="n">_____</span>
  <span class="n">_</span> <span class="n">__</span> <span class="o">|</span> <span class="o">|</span><span class="n">__</span>   <span class="n">___</span>  <span class="n">_</span> <span class="n">__</span>   <span class="n">___</span><span class="o">|</span><span class="n">___</span> <span class="o">/</span> <span class="n">_</span> <span class="n">__</span>  <span class="n">_</span>   <span class="n">_</span>
 <span class="o">|</span> <span class="s1">&#39;_ \| &#39;</span><span class="n">_</span> \ <span class="o">/</span> <span class="n">_</span> \<span class="o">|</span> <span class="s1">&#39;_ \ / _ \ |_ \| &#39;</span><span class="n">_</span> \<span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span>
 <span class="o">|</span> <span class="o">|</span><span class="n">_</span><span class="p">)</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="p">(</span><span class="n">_</span><span class="p">)</span> <span class="o">|</span><span class="n">__</span><span class="p">)</span> <span class="o">|</span> <span class="o">|</span><span class="n">_</span><span class="p">)</span> <span class="o">|</span> <span class="o">|</span><span class="n">_</span><span class="o">|</span> <span class="o">|</span>
 <span class="o">|</span> <span class="o">.</span><span class="n">__</span><span class="o">/|</span><span class="n">_</span><span class="o">|</span> <span class="o">|</span><span class="n">_</span><span class="o">|</span>\<span class="n">___</span><span class="o">/|</span><span class="n">_</span><span class="o">|</span> <span class="o">|</span><span class="n">_</span><span class="o">|</span>\<span class="n">___</span><span class="o">/</span><span class="n">____</span><span class="o">/|</span> <span class="o">.</span><span class="n">__</span><span class="o">/</span> \<span class="n">__</span><span class="p">,</span> <span class="o">|</span>
 <span class="o">|</span><span class="n">_</span><span class="o">|</span>                                <span class="o">|</span><span class="n">_</span><span class="o">|</span>    <span class="o">|</span><span class="n">___</span><span class="o">/</span>
                                          <span class="mf">1.11</span><span class="o">.</span><span class="mi">7</span>

<span class="n">Displacement</span> <span class="n">dataset</span> <span class="ow">is</span> <span class="n">read</span> <span class="kn">from</span> <span class="nn">disp_fc3.yaml.</span>
<span class="n">counter</span> <span class="p">(</span><span class="n">file</span> <span class="n">index</span><span class="p">):</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">10</span> <span class="mi">11</span> <span class="mi">12</span> <span class="mi">13</span> <span class="mi">14</span> <span class="mi">15</span> <span class="mi">16</span> <span class="mi">17</span> <span class="mi">18</span> <span class="mi">19</span> <span class="mi">20</span> <span class="mi">21</span> <span class="mi">22</span> <span class="mi">23</span> <span class="mi">24</span> <span class="mi">25</span> <span class="mi">26</span> <span class="mi">27</span> <span class="mi">28</span> <span class="mi">29</span> <span class="mi">30</span> <span class="mi">31</span> <span class="mi">32</span> <span class="mi">33</span> <span class="mi">34</span> <span class="mi">35</span> <span class="mi">36</span> <span class="mi">37</span> <span class="mi">38</span> <span class="mi">39</span> <span class="mi">40</span> <span class="mi">41</span> <span class="mi">42</span> <span class="mi">43</span> <span class="mi">44</span> <span class="mi">45</span> <span class="mi">46</span> <span class="mi">47</span> <span class="mi">48</span> <span class="mi">49</span> <span class="mi">50</span> <span class="mi">51</span>
<span class="n">FORCES_FC3</span> <span class="n">has</span> <span class="n">been</span> <span class="n">created</span><span class="o">.</span>
                 <span class="n">_</span>
   <span class="n">___</span> <span class="n">_</span> <span class="n">__</span>   <span class="n">__</span><span class="o">|</span> <span class="o">|</span>
  <span class="o">/</span> <span class="n">_</span> \ <span class="s1">&#39;_ \ / _` |</span>
 <span class="o">|</span>  <span class="n">__</span><span class="o">/</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="p">(</span><span class="n">_</span><span class="o">|</span> <span class="o">|</span>
  \<span class="n">___</span><span class="o">|</span><span class="n">_</span><span class="o">|</span> <span class="o">|</span><span class="n">_</span><span class="o">|</span>\<span class="n">__</span><span class="p">,</span><span class="n">_</span><span class="o">|</span>
</pre></div>
</div>
<p>Using <a class="reference internal" href="command-options.html#cf3-file-option"><span class="std std-ref">–cf3_file option</span></a> may be recommended
when the number of force files is large.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>% for i in `ls POSCAR-0*|sed s/POSCAR-//`;do echo disp-$i/vasprun.xml;done &gt; file_list.dat
% phono3py --cf3_file file_list.dat
</pre></div>
</div>
<p>Using a python script, <code class="docutils literal notranslate"><span class="pre">disp_fc3.yaml</span></code> is easily parsed. So
it is also easy to create the file list by a python
script:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
<span class="kn">import</span> <span class="nn">yaml</span>

<span class="n">file_name_tmpl</span> <span class="o">=</span> <span class="s2">&quot;disp-</span><span class="si">%05d</span><span class="s2">/vasprun.xml&quot;</span>
<span class="n">dds</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s2">&quot;disp_fc3.yaml&quot;</span><span class="p">))</span>
<span class="n">count</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">for</span> <span class="n">d1</span> <span class="ow">in</span> <span class="n">dds</span><span class="p">[</span><span class="s1">&#39;first_atoms&#39;</span><span class="p">]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">file_name_tmpl</span> <span class="o">%</span> <span class="n">count</span><span class="p">)</span>
    <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="k">for</span> <span class="n">d1</span> <span class="ow">in</span> <span class="n">dds</span><span class="p">[</span><span class="s1">&#39;first_atoms&#39;</span><span class="p">]:</span>
    <span class="k">for</span> <span class="n">d2</span> <span class="ow">in</span> <span class="n">d1</span><span class="p">[</span><span class="s1">&#39;second_atoms&#39;</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">d2</span><span class="p">[</span><span class="s1">&#39;displacements&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">d2</span><span class="p">[</span><span class="s1">&#39;included&#39;</span><span class="p">]:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">file_name_tmpl</span> <span class="o">%</span> <span class="n">count</span><span class="p">)</span>
            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
<div class="section" id="running-phonon-phonon-interaction-calculation">
<h3><a class="toc-backref" href="#id5">Running phonon-phonon interaction calculation</a><a class="headerlink" href="#running-phonon-phonon-interaction-calculation" title="Permalink to this headline">¶</a></h3>
<p>To create fc3, <code class="docutils literal notranslate"><span class="pre">--cutoff-pair</span></code> option is not necessary but the
special <code class="docutils literal notranslate"><span class="pre">disp_fc3.yaml</span></code> is required.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">phono3py</span> <span class="o">--</span><span class="n">dim</span><span class="o">=</span><span class="s2">&quot;2 2 2&quot;</span> <span class="o">-</span><span class="n">c</span> <span class="n">POSCAR</span><span class="o">-</span><span class="n">unitcell</span>
<span class="o">...</span>

<span class="n">Displacement</span> <span class="n">dataset</span> <span class="ow">is</span> <span class="n">read</span> <span class="kn">from</span> <span class="nn">disp_fc3.yaml.</span>
<span class="n">Sets</span> <span class="n">of</span> <span class="n">supercell</span> <span class="n">forces</span> <span class="n">are</span> <span class="n">read</span> <span class="kn">from</span> <span class="nn">FORCES_FC3.</span>
<span class="n">Solving</span> <span class="n">fc3</span><span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">x</span> <span class="p">]</span> <span class="k">with</span> <span class="n">a</span> <span class="n">displacement</span><span class="p">:</span>
    <span class="p">[</span> <span class="mf">0.0300</span>  <span class="mf">0.0000</span>  <span class="mf">0.0000</span><span class="p">]</span>
<span class="n">Expanding</span> <span class="n">fc3</span>
<span class="n">Cutting</span><span class="o">-</span><span class="n">off</span> <span class="n">fc3</span> <span class="p">(</span><span class="n">cut</span><span class="o">-</span><span class="n">off</span> <span class="n">distance</span><span class="p">:</span> <span class="mf">5.000000</span><span class="p">)</span>
<span class="n">Building</span> <span class="n">atom</span> <span class="n">mapping</span> <span class="n">table</span><span class="o">...</span>
<span class="n">Creating</span> <span class="n">contracted</span> <span class="n">fc3</span><span class="o">...</span>
<span class="n">Writing</span> <span class="n">fc3</span> <span class="n">to</span> <span class="n">fc3</span><span class="o">.</span><span class="n">hdf5</span>
<span class="nb">max</span> <span class="n">drift</span> <span class="n">of</span> <span class="n">fc3</span><span class="p">:</span> <span class="mf">0.043921</span> <span class="p">(</span><span class="n">zyx</span><span class="p">)</span> <span class="mf">0.043921</span> <span class="p">(</span><span class="n">yzx</span><span class="p">)</span> <span class="mf">0.043921</span> <span class="p">(</span><span class="n">yxz</span><span class="p">)</span>
<span class="n">Solving</span> <span class="n">fc2</span>
<span class="n">Writing</span> <span class="n">fc2</span> <span class="n">to</span> <span class="n">fc2</span><span class="o">.</span><span class="n">hdf5</span>
<span class="nb">max</span> <span class="n">drift</span> <span class="n">of</span> <span class="n">fc2</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.000001</span> <span class="p">(</span><span class="n">xx</span><span class="p">)</span> <span class="o">-</span><span class="mf">0.000001</span> <span class="p">(</span><span class="n">xx</span><span class="p">)</span>
<span class="o">***************</span> <span class="kc">None</span> <span class="n">of</span> <span class="n">ph</span><span class="o">-</span><span class="n">ph</span> <span class="n">interaction</span> <span class="n">was</span> <span class="n">calculated</span><span class="o">.</span> <span class="o">****************</span>
                 <span class="n">_</span>
   <span class="n">___</span> <span class="n">_</span> <span class="n">__</span>   <span class="n">__</span><span class="o">|</span> <span class="o">|</span>
  <span class="o">/</span> <span class="n">_</span> \ <span class="s1">&#39;_ \ / _` |</span>
 <span class="o">|</span>  <span class="n">__</span><span class="o">/</span> <span class="o">|</span> <span class="o">|</span> <span class="o">|</span> <span class="p">(</span><span class="n">_</span><span class="o">|</span> <span class="o">|</span>
  \<span class="n">___</span><span class="o">|</span><span class="n">_</span><span class="o">|</span> <span class="o">|</span><span class="n">_</span><span class="o">|</span>\<span class="n">__</span><span class="p">,</span><span class="n">_</span><span class="o">|</span>
</pre></div>
</div>
<p>Once <code class="docutils literal notranslate"><span class="pre">fc3.hdf5</span></code> and <code class="docutils literal notranslate"><span class="pre">fc2.hdf5</span></code> are created, <code class="docutils literal notranslate"><span class="pre">--cutoff-pair</span></code>
option and the special <code class="docutils literal notranslate"><span class="pre">disp_fc3.yaml</span></code> are not needed anymore.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">phono3py</span> <span class="o">--</span><span class="n">dim</span><span class="o">=</span><span class="s2">&quot;2 2 2&quot;</span> <span class="o">--</span><span class="n">pa</span><span class="o">=</span><span class="s2">&quot;0 1/2 1/2 1/2 0 1/2 1/2 1/2 0&quot;</span> <span class="o">-</span><span class="n">c</span> <span class="n">POSCAR</span><span class="o">-</span><span class="n">unitcell</span> <span class="o">--</span><span class="n">mesh</span><span class="o">=</span><span class="s2">&quot;11 11 11&quot;</span> <span class="o">--</span><span class="n">fc3</span> <span class="o">--</span><span class="n">fc2</span> <span class="o">--</span><span class="n">br</span>
<span class="o">...</span>

  <span class="mf">300.0</span>     <span class="mf">118.778</span>    <span class="mf">118.778</span>    <span class="mf">118.778</span>     <span class="o">-</span><span class="mf">0.000</span>     <span class="o">-</span><span class="mf">0.000</span>      <span class="mf">0.000</span>

<span class="o">...</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="a-script-extract-supercell-ids-from-disp-fc3-yaml">
<h2><a class="toc-backref" href="#id6">A script extract supercell IDs from <code class="docutils literal notranslate"><span class="pre">disp_fc3.yaml</span></code></a><a class="headerlink" href="#a-script-extract-supercell-ids-from-disp-fc3-yaml" title="Permalink to this headline">¶</a></h2>
<p>The following script is an example to collect supercell IDs
with the cutoff-pair distance, for which <code class="docutils literal notranslate"><span class="pre">included:</span> <span class="pre">true</span></code> is used
to hook. <code class="docutils literal notranslate"><span class="pre">duplicates</span></code> in <code class="docutils literal notranslate"><span class="pre">disp_fc3.yaml</span></code> gives the pairs of
exactly same supercells having different IDs. Therefore one of each
pair is necessary to calculate. As a ratio, the number is not many,
but if we want to save very much the computational demand, it is good
to consider.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>

<span class="kn">import</span> <span class="nn">yaml</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">yaml</span> <span class="kn">import</span> <span class="n">CLoader</span> <span class="k">as</span> <span class="n">Loader</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">yaml</span> <span class="kn">import</span> <span class="n">Loader</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;disp_fc3.yaml&quot;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">Loader</span><span class="o">=</span><span class="n">Loader</span><span class="p">)</span>

<span class="n">disp_ids</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">data1</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;first_atoms&#39;</span><span class="p">]:</span>
    <span class="n">disp_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data1</span><span class="p">[</span><span class="s1">&#39;displacement_id&#39;</span><span class="p">])</span>

<span class="k">for</span> <span class="n">data1</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;first_atoms&#39;</span><span class="p">]:</span>
    <span class="k">for</span> <span class="n">data2</span> <span class="ow">in</span> <span class="n">data1</span><span class="p">[</span><span class="s1">&#39;second_atoms&#39;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">data2</span><span class="p">[</span><span class="s1">&#39;included&#39;</span><span class="p">]:</span>
            <span class="n">disp_ids</span> <span class="o">+=</span> <span class="n">data2</span><span class="p">[</span><span class="s1">&#39;displacement_ids&#39;</span><span class="p">]</span>

<span class="c1"># # To remove duplicates</span>
<span class="c1"># duplicates = data[&#39;duplicates&#39;]</span>
<span class="c1"># print(len(duplicates))</span>
<span class="c1"># disp_ids_nodup = [i for i in disp_ids if i not in duplicates]</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;</span><span class="si">%05d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">disp_ids</span><span class="p">]))</span>
</pre></div>
</div>
<p>Even for the case that <code class="docutils literal notranslate"><span class="pre">disp_fc3.yaml</span></code> was created without
<code class="docutils literal notranslate"><span class="pre">--cutoff-pair</span></code> option, if we replace the line in the above script:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">data2</span><span class="p">[</span><span class="s1">&#39;included&#39;</span><span class="p">]:</span>
</pre></div>
</div>
<p>by</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">data2</span><span class="p">[</span><span class="s1">&#39;distance&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">5.0</span><span class="p">:</span>  <span class="c1"># 5.0 is cutoff-pair distance</span>
</pre></div>
</div>
<p>we can find the supercell IDs almost equivalent to those obtained
above for <code class="docutils literal notranslate"><span class="pre">--cutoff-pair</span> <span class="pre">5.0</span></code>.</p>
</div>
<div class="section" id="the-test">
<h2><a class="toc-backref" href="#id7">The Test</a><a class="headerlink" href="#the-test" title="Permalink to this headline">¶</a></h2>
<div class="section" id="si-pbe">
<h3><a class="toc-backref" href="#id8">Si-PBE</a><a class="headerlink" href="#si-pbe" title="Permalink to this headline">¶</a></h3>
<p>For testing, thermal conductivities with respect to <code class="docutils literal notranslate"><span class="pre">--cutoff-pair</span></code>
values are calculated as follows. Note that if <code class="docutils literal notranslate"><span class="pre">FORCES_FC3</span></code> for full
fc3 elements exists, the same <code class="docutils literal notranslate"><span class="pre">FORCES_FC3</span></code> file can be used for
generating contracted fc3 for each special <code class="docutils literal notranslate"><span class="pre">disp_fc3.yaml</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>% egrep &#39;^\s+distance&#39; disp_fc3.yaml|awk &#39;{print $2}&#39;|sort|uniq
0.000000
2.366961
3.865232
4.532386
5.466263
5.956722
6.694777
7.100884
7.730463
9.467845
% for i in {2..10};do d=`grep distance disp_fc3.yaml|awk &#39;{print $2}&#39;|sort|uniq|sed &quot;${i}q;d&quot;`; d=$((d+0.1)); phono3py --cutoff-pair=$d -o $i -d --dim=&quot;2 2 2&quot; -c POSCAR-unitcell ;done
% ls disp_fc3.*.yaml
disp_fc3.10.yaml  disp_fc3.4.yaml  disp_fc3.7.yaml
disp_fc3.2.yaml   disp_fc3.5.yaml  disp_fc3.8.yaml
disp_fc3.3.yaml   disp_fc3.6.yaml  disp_fc3.9.yaml
% for i in {2..10};do grep num_displacements_created disp_fc3.$i.yaml;done
num_displacements_created: 11
num_displacements_created: 31
num_displacements_created: 51
num_displacements_created: 56
num_displacements_created: 76
num_displacements_created: 96
num_displacements_created: 104
num_displacements_created: 109
num_displacements_created: 111
% for i in {2..10};do phono3py --dim=&quot;2 2 2&quot; --pa=&quot;0 1/2 1/2 1/2 0 1/2 1/2 1/2 0&quot; -c POSCAR-unitcell --mesh=&quot;11 11 11&quot; --br --io=$i|tee std.$i.out;done
% for i in {2..10};do egrep &#39;^\s+300&#39; std.$i.out;done
  300.0     123.559    123.559    123.559     -0.000     -0.000      0.000
  300.0     118.586    118.586    118.586     -0.000     -0.000      0.000
  300.0     118.778    118.778    118.778     -0.000     -0.000      0.000
  300.0     118.839    118.839    118.839     -0.000     -0.000      0.000
  300.0     119.433    119.433    119.433     -0.000     -0.000      0.000
  300.0     119.453    119.453    119.453     -0.000     -0.000      0.000
  300.0     119.466    119.466    119.466     -0.000     -0.000      0.000
  300.0     119.447    119.447    119.447     -0.000     -0.000      0.000
  300.0     119.445    119.445    119.445     -0.000     -0.000      0.000
% for i in {2..10};do phono3py --dim=&quot;2 2 2&quot; --pa=&quot;0 1/2 1/2 1/2 0 1/2 1/2 1/2 0&quot; -c POSCAR-unitcell --mesh=&quot;11 11 11&quot; --sym-fc --br -i $i -o sym-$i|tee std.sym-$i.out;done
% for i in {2..10};do egrep &#39;^\s+300&#39; std.sym-$i.out;done
  300.0     124.626    124.626    124.626     -0.000      0.000      0.000
  300.0     119.721    119.721    119.721     -0.000      0.000      0.000
  300.0     118.806    118.806    118.806     -0.000      0.000      0.000
  300.0     118.741    118.741    118.741     -0.000      0.000      0.000
  300.0     119.446    119.446    119.446     -0.000      0.000      0.000
  300.0     119.339    119.339    119.339     -0.000      0.000      0.000
  300.0     119.323    119.323    119.323     -0.000      0.000      0.000
  300.0     119.313    119.313    119.313     -0.000      0.000      0.000
  300.0     119.311    119.311    119.311     -0.000      0.000      0.000
</pre></div>
</div>
</div>
<div class="section" id="aln-lda">
<h3><a class="toc-backref" href="#id9">AlN-LDA</a><a class="headerlink" href="#aln-lda" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>% egrep &#39;^\s+distance&#39; disp_fc3.yaml|awk &#39;{print $2}&#39;|sort|uniq
0.000000
1.889907
1.901086
3.069402
3.076914
3.111000
3.640065
3.645881
4.370303
4.375582
4.743307
4.743308
4.788360
4.978000
5.364501
5.388410
5.672503
5.713938
5.870162
6.205027
6.469591
7.335901
% for i in {2..22};do d=`egrep &#39;^\s+distance&#39; disp_fc3.yaml|awk &#39;{print $2}&#39;|sort|uniq|sed &quot;${i}q;d&quot;`; d=$((d+0.0001)); phono3py --cutoff-pair=$d -o $i -d --dim=&quot;3 3 2&quot; -c POSCAR-unitcell ;done
% for i in {2..22};do grep num_displacements_created disp_fc3.$i.yaml;done
num_displacements_created: 78
num_displacements_created: 98
num_displacements_created: 202
num_displacements_created: 222
num_displacements_created: 318
num_displacements_created: 370
num_displacements_created: 466
num_displacements_created: 570
num_displacements_created: 666
num_displacements_created: 718
num_displacements_created: 718
num_displacements_created: 770
num_displacements_created: 790
num_displacements_created: 894
num_displacements_created: 934
num_displacements_created: 986
num_displacements_created: 1026
num_displacements_created: 1122
num_displacements_created: 1162
num_displacements_created: 1214
num_displacements_created: 1254
% for i in {2..22};do phono3py --dim=&quot;3 3 2&quot; -c POSCAR-unitcell --mesh=&quot;13 13 9&quot; --br --nac --io $i|tee std.$i.out; done
% for i in {2..22};do egrep &#39;^\s+300\.0&#39; std.$i.out;done
  300.0     201.530    201.530    192.685     -0.000     -0.000     -0.000
  300.0     212.963    212.963    204.362     -0.000     -0.000     -0.000
  300.0     208.005    208.005    196.684     -0.000     -0.000     -0.000
  300.0     212.213    212.213    200.778     -0.000     -0.000     -0.000
  300.0     223.019    223.019    214.702     -0.000     -0.000     -0.000
  300.0     223.181    223.181    214.351     -0.000     -0.000     -0.000
  300.0     222.360    222.360    213.924     -0.000     -0.000     -0.000
  300.0     223.245    223.245    214.561     -0.000     -0.000     -0.000
  300.0     223.812    223.812    215.359     -0.000     -0.000     -0.000
  300.0     223.959    223.959    215.701     -0.000     -0.000     -0.000
  300.0     223.959    223.959    215.701     -0.000     -0.000     -0.000
  300.0     224.507    224.507    215.384     -0.000     -0.000     -0.000
  300.0     224.278    224.278    215.396     -0.000     -0.000     -0.000
  300.0     223.551    223.551    212.671     -0.000     -0.000     -0.000
  300.0     224.732    224.732    214.463     -0.000     -0.000     -0.000
  300.0     224.291    224.291    213.270     -0.000     -0.000     -0.000
  300.0     224.805    224.805    214.771     -0.000     -0.000     -0.000
  300.0     224.834    224.834    215.025     -0.000     -0.000     -0.000
  300.0     224.645    224.645    215.260     -0.000     -0.000     -0.000
  300.0     224.769    224.769    215.220     -0.000     -0.000     -0.000
  300.0     224.650    224.650    215.090     -0.000     -0.000     -0.000
% for i in {2..22};do phono3py --dim=&quot;3 3 2&quot; -c POSCAR-unitcell --mesh=&quot;13 13 9&quot; --sym-fc --br --nac -i $i -o sym-$i|tee std.sym-$i.out; done
% for i in {2..22};do egrep &#39;^\s+300\.0&#39; std.sym-$i.out;done
  300.0     224.122    224.122    213.086      0.000     -0.000      0.000
  300.0     225.394    225.394    215.683      0.000     -0.000      0.000
  300.0     223.748    223.748    213.682      0.000     -0.000      0.000
  300.0     223.973    223.973    213.543      0.000     -0.000      0.000
  300.0     224.876    224.876    216.489      0.000     -0.000      0.000
  300.0     224.603    224.603    216.204      0.000     -0.000      0.000
  300.0     223.773    223.773    214.657      0.000     -0.000      0.000
  300.0     224.173    224.173    215.517      0.000     -0.000      0.000
  300.0     224.596    224.596    215.896      0.000     -0.000      0.000
  300.0     224.401    224.401    215.955      0.000     -0.000      0.000
  300.0     224.401    224.401    215.955      0.000     -0.000      0.000
  300.0     224.077    224.077    215.565      0.000     -0.000      0.000
  300.0     224.285    224.285    215.654      0.000     -0.000      0.000
  300.0     224.136    224.136    215.053      0.000     -0.000      0.000
  300.0     224.469    224.469    215.462      0.000     -0.000      0.000
  300.0     224.109    224.109    215.011      0.000     -0.000      0.000
  300.0     224.108    224.108    215.447      0.000     -0.000      0.000
  300.0     224.592    224.592    215.046      0.000     -0.000      0.000
  300.0     224.640    224.640    215.113      0.000     -0.000      0.000
  300.0     224.344    224.344    215.203      0.000     -0.000      0.000
  300.0     224.481    224.481    214.936      0.000     -0.000      0.000
</pre></div>
</div>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
<div id="sourcelink">
  <a href="_sources/cutoff-pair.rst.txt"
     rel="nofollow">Source</a>
</div>
      
    </p>
    <p>
        &copy; Copyright 2015, Atsushi Togo.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.5.4.<br/>
    </p>
  </div>
</footer>
  </body>
</html>