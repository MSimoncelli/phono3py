
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Installation &#8212; Phono3py v.2.0.0</title>
    
  <link href="_static/css/theme.css" rel="stylesheet" />
  <link href="_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/sphinx-book-theme.acff12b8f9c144ce68a297486a2fa670.css" type="text/css" />
    
  <link rel="preload" as="script" href="_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Examples" href="examples.html" />
    <link rel="prev" title="Welcome to phono3py" href="index.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
      
      <h1 class="site-logo" id="site-title">Phono3py v.2.0.0</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <div class="bd-toc-item active">
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Installation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="examples.html">
   Examples
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="interfaces.html">
   Interfaces to calculators (VASP, QE, CRYSTAL, Abinit, TURBOMOLE)
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="vasp.html">
     VASP &amp; phono3py calculation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="qe.html">
     Quantum ESPRESSO (pw) &amp; phono3py calculation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="crystal.html">
     CRYSTAL &amp; phono3py calculation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="turbomole.html">
     TURBOMOLE &amp; phono3py calculation
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="command-options.html">
   Command options / Setting tags
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="output-files.html">
   Output files
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="hdf5_howto.html">
   How to read the results stored in hdf5 files
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="auxiliary-tools.html">
   Auxiliary tools
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="direct-solution.html">
   Direct solution of linearized phonon Boltzmann equation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="workload-distribution.html">
   Workload distribution
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cutoff-pair.html">
   Force constants calculation with cutoff pair-distance
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="external-tools.html">
   External tools
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="tips.html">
   Tips
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="citation.html">
   How to cite phono3py
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="changelog.html">
   Change Log
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/install.md.txt"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#installation-using-conda">
   Installation using conda
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#installation-using-pip-is-not-recommended">
   Installation using pip is not recommended
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#installation-from-source-code">
   Installation from source code
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#installation-of-lapacke">
     Installation of LAPACKE
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#mkl-lapacke-with-multithread-blas">
     MKL LAPACKE (with multithread BLAS)
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#openblas-provided-by-conda-with-multithread-blas">
     OpenBLAS provided by conda (with multithread BLAS)
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#netlib-lapacke-provided-by-ubuntu-package-manager-with-single-thread-blas">
     Netlib LAPACKE provided by Ubuntu package manager (with single-thread BLAS)
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#compiling-netlib-lapacke">
     Compiling Netlib LAPACKE
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#building-using-setup-py">
   Building using setup.py
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#installation-instruction-of-latest-development-version-of-phono3py">
   Installation instruction of latest development version of phono3py
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#multithreading-and-its-controlling-by-c-macro">
   Multithreading and its controlling by C macro
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#trouble-shooting">
   Trouble shooting
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="installation">
<span id="install"></span><h1>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h1>
<p>The detailed installation processes for different environments
are described below. The easiest installation with a good computation
performance is achieved by using the phono3py conda package (see
<a class="reference internal" href="#install-an-example"><span class="std std-ref">Installation instruction of latest development version of phono3py</span></a>).</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#installation-using-conda" id="id1">Installation using conda</a></p></li>
<li><p><a class="reference internal" href="#installation-using-pip-is-not-recommended" id="id2">Installation using pip is not recommended</a></p></li>
<li><p><a class="reference internal" href="#installation-from-source-code" id="id3">Installation from source code</a></p>
<ul>
<li><p><a class="reference internal" href="#installation-of-lapacke" id="id4">Installation of LAPACKE</a></p></li>
<li><p><a class="reference internal" href="#mkl-lapacke-with-multithread-blas" id="id5">MKL LAPACKE (with multithread BLAS)</a></p></li>
<li><p><a class="reference internal" href="#openblas-provided-by-conda-with-multithread-blas" id="id6">OpenBLAS provided by conda (with multithread BLAS)</a></p></li>
<li><p><a class="reference internal" href="#netlib-lapacke-provided-by-ubuntu-package-manager-with-single-thread-blas" id="id7">Netlib LAPACKE provided by Ubuntu package manager (with single-thread BLAS)</a></p></li>
<li><p><a class="reference internal" href="#compiling-netlib-lapacke" id="id8">Compiling Netlib LAPACKE</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#building-using-setup-py" id="id9">Building using setup.py</a></p></li>
<li><p><a class="reference internal" href="#installation-instruction-of-latest-development-version-of-phono3py" id="id10">Installation instruction of latest development version of phono3py</a></p></li>
<li><p><a class="reference internal" href="#multithreading-and-its-controlling-by-c-macro" id="id11">Multithreading and its controlling by C macro</a></p></li>
<li><p><a class="reference internal" href="#trouble-shooting" id="id12">Trouble shooting</a></p></li>
</ul>
</div>
<p>Installation of phonopy before the installation of phono3py is
required. See how to install phonopy at
<a class="reference external" href="https://phonopy.github.io/phonopy/install.html">https://phonopy.github.io/phonopy/install.html</a>. Phono3py relies on
phonopy, so please use the latest release of phonopy when installing
phono3py.</p>
<div class="section" id="installation-using-conda">
<h2><a class="toc-backref" href="#id1">Installation using conda</a><a class="headerlink" href="#installation-using-conda" title="Permalink to this headline">¶</a></h2>
<p>Using conda is the easiest way for installation of phono3py if you are
using x86-64 linux system or macOS. These packages are made and
maintained by Jan Janssen. The installation is simply done by:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>   % conda install -c conda-forge phono3py
</pre></div>
</div>
<p>All dependent packages should be installed.</p>
</div>
<div class="section" id="installation-using-pip-is-not-recommended">
<h2><a class="toc-backref" href="#id2">Installation using pip is not recommended</a><a class="headerlink" href="#installation-using-pip-is-not-recommended" title="Permalink to this headline">¶</a></h2>
<p>PyPI packages are prepared for phonopy and phono3py releases. When
installing with PyPI, <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> is executed locally to compile the
part of the code written in C, so a few libraries such as
lapacke must exist in the system. Those necessary libraries are
explained in the next section.</p>
</div>
<div class="section" id="installation-from-source-code">
<h2><a class="toc-backref" href="#id3">Installation from source code</a><a class="headerlink" href="#installation-from-source-code" title="Permalink to this headline">¶</a></h2>
<p>When installing phono3py using <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> from the source code, a
few libraries are required before running <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> script.</p>
<p>For phono3py, OpenMP library is necessary for the multithreding
support. In additon, BLAS, LAPACK, and LAPACKE are also needed. These
packages are probably installed using the package manager for each OS
or conda.</p>
<p>When using gcc to compile phono3py, <code class="docutils literal notranslate"><span class="pre">libgomp1</span></code> is necessary to
enable OpenMP multithreading support. This library is probably
installed already in your system. If you don’t have it and you use
Ubuntu linux, it is installed by:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>   % sudo apt-get install libgomp1
</pre></div>
</div>
<div class="section" id="installation-of-lapacke">
<span id="install-lapacke"></span><h3><a class="toc-backref" href="#id4">Installation of LAPACKE</a><a class="headerlink" href="#installation-of-lapacke" title="Permalink to this headline">¶</a></h3>
<p>LAPACK library is used in a few parts of the code to diagonalize
matrices. LAPACK<em>E</em> is the C-wrapper of LAPACK and LAPACK relies on
BLAS. Both single-thread or multithread BLAS can be
used in phono3py. In the following, multiple different ways of
installation of LAPACKE are explained.</p>
</div>
<div class="section" id="mkl-lapacke-with-multithread-blas">
<span id="install-mkl-lapacke"></span><h3><a class="toc-backref" href="#id5">MKL LAPACKE (with multithread BLAS)</a><a class="headerlink" href="#mkl-lapacke-with-multithread-blas" title="Permalink to this headline">¶</a></h3>
<p>Phono3py can be compiled with MKL for using LAPACKE.  If <code class="docutils literal notranslate"><span class="pre">setup.py</span></code>
finds the file named <code class="docutils literal notranslate"><span class="pre">setup_mkl.py</span></code>, the contents of <code class="docutils literal notranslate"><span class="pre">setup_mkl.py</span></code> is read
and those are included in the compilation setting.  For example, the
following setting prepared as <code class="docutils literal notranslate"><span class="pre">setup_mkl.py</span></code> seems working on Ubuntu 16.04
system:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>   <span class="n">intel_root</span> <span class="o">=</span> <span class="s2">&quot;/opt/intel/composer_xe_2015.7.235&quot;</span>
   <span class="n">mkl_root</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">/mkl&quot;</span> <span class="o">%</span> <span class="n">intel_root</span>
   <span class="n">compiler_root</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">/compiler&quot;</span> <span class="o">%</span> <span class="n">intel_root</span>

   <span class="n">mkl_extra_link_args_lapacke</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;-L</span><span class="si">%s</span><span class="s1">/lib/intel64&#39;</span> <span class="o">%</span> <span class="n">mkl_root</span><span class="p">,</span>
                                  <span class="s1">&#39;-lmkl_rt&#39;</span><span class="p">]</span>
   <span class="n">mkl_extra_link_args_lapacke</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;-L</span><span class="si">%s</span><span class="s1">/lib/intel64&#39;</span> <span class="o">%</span> <span class="n">compiler_root</span><span class="p">,</span>
                                   <span class="s1">&#39;-lsvml&#39;</span><span class="p">,</span>
                                   <span class="s1">&#39;-liomp5&#39;</span><span class="p">,</span>
                                   <span class="s1">&#39;-limf&#39;</span><span class="p">,</span>
                                   <span class="s1">&#39;-lpthread&#39;</span><span class="p">]</span>
   <span class="n">mkl_include_dirs_lapacke</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">/include&quot;</span> <span class="o">%</span> <span class="n">mkl_root</span><span class="p">]</span>
</pre></div>
</div>
<p>This setting considers to use <code class="docutils literal notranslate"><span class="pre">icc</span></code> but it may be compiled with
<code class="docutils literal notranslate"><span class="pre">gcc</span></code>. With <code class="docutils literal notranslate"><span class="pre">gcc</span></code>, the compiler related setting shown above (i.e.,
around <code class="docutils literal notranslate"><span class="pre">compiler_root</span></code>) is unnecessary. To achieve this
installation, not only the MKL library but also the header file are
necessary. The libraries are linked dynamically, so in most of the
cases, <code class="docutils literal notranslate"><span class="pre">LD_LIBRARY_PATH</span></code> environment variable has to be correctly
specified to let phono3py find those libraries.</p>
</div>
<div class="section" id="openblas-provided-by-conda-with-multithread-blas">
<span id="install-openblas-lapacke"></span><h3><a class="toc-backref" href="#id6">OpenBLAS provided by conda (with multithread BLAS)</a><a class="headerlink" href="#openblas-provided-by-conda-with-multithread-blas" title="Permalink to this headline">¶</a></h3>
<p>The installtion of LAPACKE is easy by conda. It is:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>   % conda install -c conda-forge openblas libgfortran
</pre></div>
</div>
<p>The recent change of openblas package provided from anaconda makes to
install nomkl, i.e., numpy and scipy with Intel MKL cannot be used
together with openblas. At this moment, this is avoided to install
openblas from conda-forge channel. If the python libraries are not yet
installed by</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>   % conda install -c conda-forge numpy scipy h5py pyyaml matplotlib
</pre></div>
</div>
<p>Note that using hdf5 files on NFS mouted file system, you may have to
disable file locking by setting</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>   <span class="nb">export</span> <span class="nv">HDF5_USE_FILE_LOCKING</span><span class="o">=</span>FALSE
</pre></div>
</div>
<p>This openblas package contains BLAS, LAPACK, and LAPACKE. When this
<code class="docutils literal notranslate"><span class="pre">libopenblas</span></code> is linked and the <code class="docutils literal notranslate"><span class="pre">else</span></code> statement of the C macro
definition section in <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> is executed, the following macro
are activated:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>   <span class="k">if</span> <span class="n">use_setuptools</span><span class="p">:</span>
       <span class="n">extra_compile_args</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;-DMULTITHREADED_BLAS&#39;</span><span class="p">]</span>
   <span class="k">else</span><span class="p">:</span>
       <span class="n">define_macros</span> <span class="o">+=</span> <span class="p">[(</span><span class="s1">&#39;MULTITHREADED_BLAS&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)]</span>
</pre></div>
</div>
<p>Libraries or headers are not found at the build by <code class="docutils literal notranslate"><span class="pre">setup.py</span></code>, the
following setting may be of the help:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="n">extra_link_args_lapacke</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;-lopenblas&#39;</span><span class="p">,</span> <span class="s1">&#39;-lgfortran&#39;</span><span class="p">]</span>
    <span class="n">include_dirs_lapacke</span> <span class="o">+=</span> <span class="p">[</span>
        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;CONDA_PREFIX&#39;</span><span class="p">],</span> <span class="s1">&#39;include&#39;</span><span class="p">),</span> <span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="netlib-lapacke-provided-by-ubuntu-package-manager-with-single-thread-blas">
<h3><a class="toc-backref" href="#id7">Netlib LAPACKE provided by Ubuntu package manager (with single-thread BLAS)</a><a class="headerlink" href="#netlib-lapacke-provided-by-ubuntu-package-manager-with-single-thread-blas" title="Permalink to this headline">¶</a></h3>
<p>In the versions of Ubuntu-12.10 or later, LAPACKE
(<a class="reference external" href="http://www.netlib.org/lapack/lapacke.html">http://www.netlib.org/lapack/lapacke.html</a>) can be installed from the
package manager (<code class="docutils literal notranslate"><span class="pre">liblapacke</span></code> and <code class="docutils literal notranslate"><span class="pre">liblapacke-dev</span></code>):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>   % sudo apt-get install liblapack-dev liblapacke-dev
</pre></div>
</div>
</div>
<div class="section" id="compiling-netlib-lapacke">
<h3><a class="toc-backref" href="#id8">Compiling Netlib LAPACKE</a><a class="headerlink" href="#compiling-netlib-lapacke" title="Permalink to this headline">¶</a></h3>
<p>The compilation procedure is found at the LAPACKE web site. After
creating the LAPACKE library, <code class="docutils literal notranslate"><span class="pre">liblapacke.a</span></code> (or the dynamic link
library), <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> must be properly modified to link it. As an
example, the procedure of compiling LAPACKE is shown below.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>   % tar xvfz lapack-3.6.0.tgz
   % <span class="nb">cd</span> lapack-3.6.0
   % cp make.inc.example make.inc
   % make lapackelib
</pre></div>
</div>
<p>BLAS, LAPACK, and LAPACKE, these all may have to be compiled
with <code class="docutils literal notranslate"><span class="pre">-fPIC</span></code> option to use it with python.</p>
</div>
</div>
<div class="section" id="building-using-setup-py">
<h2>Building using <a class="reference external" href="http://setup.py">setup.py</a><a class="headerlink" href="#building-using-setup-py" title="Permalink to this headline">¶</a></h2>
<p>If package installation is not possible or you want to compile with
special compiler or special options, phono3py is built using
<a class="reference external" href="http://setup.py">setup.py</a>. In this case, manual modification of <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> may be
needed.</p>
<ol>
<li><p>Download the latest source code at</p>
<p><a class="reference external" href="https://pypi.python.org/pypi/phono3py">https://pypi.python.org/pypi/phono3py</a></p>
</li>
<li><p>and extract it:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">tar</span> <span class="n">xvfz</span> <span class="n">phono3py</span><span class="o">-</span><span class="mf">1.11</span><span class="o">.</span><span class="mf">13.39</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span>
<span class="o">%</span> <span class="n">cd</span> <span class="n">phono3py</span><span class="o">-</span><span class="mf">1.11</span><span class="o">.</span><span class="mf">13.39</span>
</pre></div>
</div>
<p>The other option is using git to clone the phonopy repository from github:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">phonopy</span><span class="o">/</span><span class="n">phono3py</span><span class="o">.</span><span class="n">git</span>
<span class="o">%</span> <span class="n">cd</span> <span class="n">phono3py</span>
</pre></div>
</div>
</li>
<li><p>Set up C-libraries for python C-API and python codes. This can be
done as follows:</p>
<p>Run <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> script via pip:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">e</span> <span class="o">.</span>
</pre></div>
</div>
</li>
<li><p>Set :envvar:<code class="docutils literal notranslate"><span class="pre">$PATH</span></code> and :envvar:<code class="docutils literal notranslate"><span class="pre">$PYTHONPATH</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">PATH</span></code> and <code class="docutils literal notranslate"><span class="pre">PYTHONPATH</span></code> are set in the same way as phonopy, see
<a class="reference external" href="https://phonopy.github.io/phonopy/install.html#building-using-setup-py">https://phonopy.github.io/phonopy/install.html#building-using-setup-py</a>.</p>
</li>
</ol>
</div>
<div class="section" id="installation-instruction-of-latest-development-version-of-phono3py">
<span id="install-an-example"></span><h2><a class="toc-backref" href="#id10">Installation instruction of latest development version of phono3py</a><a class="headerlink" href="#installation-instruction-of-latest-development-version-of-phono3py" title="Permalink to this headline">¶</a></h2>
<p>When using conda, <code class="docutils literal notranslate"><span class="pre">PYTHONPATH</span></code> should not be set if possible because
potentially wrong python libraries can be imported.</p>
<p>This installation instruction supposes linux x86-64 environment.</p>
<ol>
<li><p>Download miniconda package</p>
<p>Miniconda is downloaded at <a class="reference external" href="https://conda.io/miniconda.html">https://conda.io/miniconda.html</a>.</p>
<p>For usual 64-bit Linux system:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>  % wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh -O ~/miniconda.sh
</pre></div>
</div>
<p>For macOS:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>  % wget https://repo.anaconda.com/miniconda/Miniconda3-latest-MacOSX-x86_64.sh -O ~/miniconda.sh
</pre></div>
</div>
<p>The installation is made by</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>% bash ~/miniconda.sh -b -p <span class="nv">$HOME</span>/miniconda
% <span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$HOME</span><span class="s2">/miniconda/bin:</span><span class="nv">$PATH</span><span class="s2">&quot;</span>
</pre></div>
</div>
<p>The detailed installation instruction is found at
<a class="reference external" href="https://conda.io/projects/conda/en/latest/user-guide/install/index.html">https://conda.io/projects/conda/en/latest/user-guide/install/index.html</a>. To
use the conda-forge channel as the default one, <code class="docutils literal notranslate"><span class="pre">~/.condarc</span></code> may be
written following the conda-forge official documentation
(<a class="reference external" href="https://conda-forge.org/docs/user/tipsandtricks.html">https://conda-forge.org/docs/user/tipsandtricks.html</a>).</p>
</li>
<li><p>Initialization of conda and setup of conda environment</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>% conda init &lt;your_shell&gt;
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">&lt;your_shell&gt;</span></code> is often <code class="docutils literal notranslate"><span class="pre">bash</span></code> but may be something else. It is
important that after running <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">init</span></code>, your shell is needed
to be closed and restarted. See more information by <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">init</span> <span class="pre">--help</span></code>.</p>
<p>Then conda allows to make conda installation isolated by using conda’s
virtual environment.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>% conda create -n phono3py -c conda-forge <span class="nv">python</span><span class="o">=</span><span class="m">3</span>.8
% conda activate phono3py
</pre></div>
</div>
<p>Use of this is strongly recommended, otherwise proper settings of
<code class="docutils literal notranslate"><span class="pre">CONDA_PREFIX</span></code>, <code class="docutils literal notranslate"><span class="pre">C_INCLUDE_PATH</span></code>, and <code class="docutils literal notranslate"><span class="pre">LD_LIBRARY_PATH</span></code> will
be necessary.</p>
</li>
<li><p>Install necessary conda packages for phono3py</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>% conda install -c conda-forge numpy scipy h5py pyyaml matplotlib-base compilers <span class="s2">&quot;libblas=*=*mkl&quot;</span> spglib mkl-include
</pre></div>
</div>
<p>Note that using hdf5 files on NFS mouted file system, you may have to
disable file locking by setting</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>   <span class="nb">export</span> <span class="nv">HDF5_USE_FILE_LOCKING</span><span class="o">=</span>FALSE
</pre></div>
</div>
<p>Install the latest phonopy and phono3py from github sources:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>% mkdir dev
% <span class="nb">cd</span> dev
% git clone https://github.com/phonopy/phonopy.git
% git clone https://github.com/phonopy/phono3py.git
% <span class="nb">cd</span> phonopy
% git checkout develop
% python setup.py build
% pip install -e .
% <span class="nb">cd</span> ../phono3py
% git checkout develop
% python setup.py build
% pip install -e .
</pre></div>
</div>
<p>The conda packages dependency can often change and this recipe may
not work properly. So if you find this instruction doesn’t work, it
is very appreciated if letting us know it in the phonopy mailing
list.</p>
</li>
</ol>
</div>
<div class="section" id="multithreading-and-its-controlling-by-c-macro">
<h2><a class="toc-backref" href="#id11">Multithreading and its controlling by C macro</a><a class="headerlink" href="#multithreading-and-its-controlling-by-c-macro" title="Permalink to this headline">¶</a></h2>
<p>Phono3py uses multithreading concurrency in two ways. One is that
written in the code with OpenMP <code class="docutils literal notranslate"><span class="pre">parallel</span> <span class="pre">for</span></code>. The other is
achieved by using multithreaded BLAS. The BLAS multithreading is
depending on which BLAS library is chosen by users and the number of
threads to be used may be controlled by the library’s environment
variables (e.g., <code class="docutils literal notranslate"><span class="pre">OPENBLAS_NUM_THREADS</span></code> or <code class="docutils literal notranslate"><span class="pre">MKL_NUM_THREADS</span></code>). In
the phono3py C code, these two are written in a nested way, but of
course the nested use of multiple multithreadings has to be
avoided. The outer loop of the nesting is done by the OpenMP
<code class="docutils literal notranslate"><span class="pre">parallel</span> <span class="pre">for</span></code> code. The inner loop calls LAPACKE functions and then
the LAPACKE functions call the BLAS routines. If both of the inner and
outer multithreadings can be activated, the inner multithreading must
be deactivated at the compilation time. This is achieved by setting
the C macro <code class="docutils literal notranslate"><span class="pre">MULTITHREADED_BLAS</span></code>, which can be written in
<code class="docutils literal notranslate"><span class="pre">setup.py</span></code>. Deactivating the multithreading of BLAS using the
environment variables is not recommended because it is used in the
non-nested parts of the code and these multithreadings are
unnecessary to be deactivated.</p>
</div>
<div class="section" id="trouble-shooting">
<h2><a class="toc-backref" href="#id12">Trouble shooting</a><a class="headerlink" href="#trouble-shooting" title="Permalink to this headline">¶</a></h2>
<ol class="simple">
<li><p>Phonopy version should be the latest to use the latest phono3py.</p></li>
<li><p>There are other pitfalls, see
<a class="reference external" href="https://phonopy.github.io/phonopy/install.html#trouble-shooting">https://phonopy.github.io/phonopy/install.html#trouble-shooting</a>.</p></li>
</ol>
</div>
</div>


              </div>
              
        
        <div class='prev-next-bottom'>
            
    <a class='left-prev' id="prev-link" href="index.html" title="previous page">Welcome to phono3py</a>
    <a class='right-next' id="next-link" href="examples.html" title="next page">Examples</a>

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
            &copy; Copyright 2015, Atsushi Togo.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>