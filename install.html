<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Installation &#8212; Phono3py v.1.22.3</title>
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Examples" href="examples.html" />
    <link rel="prev" title="Welcome to phono3py" href="index.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="_static/js/jquery-1.12.4.min.js "></script>
<script type="text/javascript" src="_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="_static/bootstrap-3.4.1/js/bootstrap.min.js "></script>
<script type="text/javascript" src="_static/bootstrap-sphinx.js "></script>

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html">
          Phono3py</a>
        <span class="navbar-text navbar-version pull-left"><b>1.22</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#installation-using-conda">Installation using conda</a></li>
<li class="toctree-l2"><a class="reference internal" href="#installation-using-pip-is-not-recommended">Installation using pip is not recommended</a></li>
<li class="toctree-l2"><a class="reference internal" href="#installation-from-source-code">Installation from source code</a></li>
<li class="toctree-l2"><a class="reference internal" href="#installation-instruction-of-latest-development-version-of-phono3py">Installation instruction of latest development version of phono3py</a></li>
<li class="toctree-l2"><a class="reference internal" href="#multithreading-and-its-controlling-by-c-macro">Multithreading and its controlling by C macro</a></li>
<li class="toctree-l2"><a class="reference internal" href="#trouble-shooting">Trouble shooting</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="interfaces.html">Interfaces to calculators (VASP, QE, CRYSTAL, Abinit, TURBOMOLE)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="vasp.html">VASP &amp; phono3py calculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="qe.html">Quantum ESPRESSO (pw) &amp; phono3py calculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="crystal.html">CRYSTAL &amp; phono3py calculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="turbomole.html">TURBOMOLE &amp; phono3py calculation</a></li>
<li class="toctree-l2"><a class="reference internal" href="interfaces.html#calculator-specific-behaviors">Calculator specific behaviors</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="command-options.html">Command options / Setting tags</a><ul>
<li class="toctree-l2"><a class="reference internal" href="command-options.html#input-cell-file-name">Input cell file name</a></li>
<li class="toctree-l2"><a class="reference internal" href="command-options.html#calculator-interface">Calculator interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="command-options.html#utilities-to-create-default-input-files">Utilities to create default input files</a></li>
<li class="toctree-l2"><a class="reference internal" href="command-options.html#supercell-and-primitive-cell">Supercell and primitive cell</a></li>
<li class="toctree-l2"><a class="reference internal" href="command-options.html#displacement-creation">Displacement creation</a></li>
<li class="toctree-l2"><a class="reference internal" href="command-options.html#force-constants">Force constants</a></li>
<li class="toctree-l2"><a class="reference internal" href="command-options.html#reciprocal-space-sampling-mesh-and-grid-points-and-band-indices">Reciprocal space sampling mesh and grid points, and band indices</a></li>
<li class="toctree-l2"><a class="reference internal" href="command-options.html#brillouin-zone-integration">Brillouin zone integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="command-options.html#method-to-solve-bte">Method to solve BTE</a></li>
<li class="toctree-l2"><a class="reference internal" href="command-options.html#scattering">Scattering</a></li>
<li class="toctree-l2"><a class="reference internal" href="command-options.html#temperature">Temperature</a></li>
<li class="toctree-l2"><a class="reference internal" href="command-options.html#non-analytical-term-correction">Non-analytical term correction</a></li>
<li class="toctree-l2"><a class="reference internal" href="command-options.html#imaginary-part-of-self-energy">Imaginary part of self energy</a></li>
<li class="toctree-l2"><a class="reference internal" href="command-options.html#joint-density-of-states">Joint density of states</a></li>
<li class="toctree-l2"><a class="reference internal" href="command-options.html#sampling-frequency-for-distribution-functions">Sampling frequency for distribution functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="command-options.html#mode-gruneisen-parameter-from-3rd-order-force-constants">Mode-Gruneisen parameter from 3rd order force constants</a></li>
<li class="toctree-l2"><a class="reference internal" href="command-options.html#file-i-o">File I/O</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="output-files.html">Output files</a><ul>
<li class="toctree-l2"><a class="reference internal" href="output-files.html#intermediate-text-files">Intermediate text files</a></li>
<li class="toctree-l2"><a class="reference internal" href="output-files.html#hdf5-files">HDF5 files</a></li>
<li class="toctree-l2"><a class="reference internal" href="output-files.html#simple-text-file">Simple text file</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="hdf5_howto.html">How to read the results stored in hdf5 files</a><ul>
<li class="toctree-l2"><a class="reference internal" href="hdf5_howto.html#how-to-use-hdf5-python-library">How to use HDF5 python library</a></li>
<li class="toctree-l2"><a class="reference internal" href="hdf5_howto.html#details-of-kappa-hdf5-file">Details of <code class="docutils literal notranslate"><span class="pre">kappa-*.hdf5</span></code> file</a></li>
<li class="toctree-l2"><a class="reference internal" href="hdf5_howto.html#how-to-know-grid-point-number-corresponding-to-grid-address">How to know grid point number corresponding to grid address</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="auxiliary-tools.html">Auxiliary tools</a><ul>
<li class="toctree-l2"><a class="reference internal" href="auxiliary-tools.html#phono3py-kaccum"><code class="docutils literal notranslate"><span class="pre">phono3py-kaccum</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="auxiliary-tools.html#phono3py-kdeplot"><code class="docutils literal notranslate"><span class="pre">phono3py-kdeplot</span></code></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="direct-solution.html">Direct solution of linearized phonon Boltzmann equation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="direct-solution.html#how-to-use">How to use</a></li>
<li class="toctree-l2"><a class="reference internal" href="direct-solution.html#memory-usage">Memory usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="direct-solution.html#work-load-distribution">Work load distribution</a></li>
<li class="toctree-l2"><a class="reference internal" href="direct-solution.html#cutoff-parameter-of-pseudo-inversion">Cutoff parameter of pseudo inversion</a></li>
<li class="toctree-l2"><a class="reference internal" href="direct-solution.html#installation-of-diagonalization-solvers-with-multithreaded-blas">Installation of diagonalization solvers with multithreaded BLAS</a></li>
<li class="toctree-l2"><a class="reference internal" href="direct-solution.html#solver-choice-for-diagonalization">Solver choice for diagonalization</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="workload-distribution.html">Workload distribution</a><ul>
<li class="toctree-l2"><a class="reference internal" href="workload-distribution.html#how-to-do-it">How to do it</a></li>
<li class="toctree-l2"><a class="reference internal" href="workload-distribution.html#a-convenient-script">A convenient script</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="cutoff-pair.html">Force constants calculation with cutoff pair-distance</a><ul>
<li class="toctree-l2"><a class="reference internal" href="cutoff-pair.html#what-is-cutff-pair-distance-in-phono3py">What is cutff pair-distance in phono3py?</a></li>
<li class="toctree-l2"><a class="reference internal" href="cutoff-pair.html#usage">Usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="cutoff-pair.html#a-script-extract-supercell-ids-from-disp-fc3-yaml">A script extract supercell IDs from <code class="docutils literal notranslate"><span class="pre">disp_fc3.yaml</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="cutoff-pair.html#the-test">The Test</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="external-tools.html">External tools</a><ul>
<li class="toctree-l2"><a class="reference internal" href="external-tools.html#phono3py-power-tools">Phono3py-Power-Tools</a></li>
<li class="toctree-l2"><a class="reference internal" href="external-tools.html#kinetic-collective-model">Kinetic Collective Model</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="tips.html">Tips</a><ul>
<li class="toctree-l2"><a class="reference internal" href="tips.html#brillouin-zone-summation">Brillouin zone summation</a></li>
<li class="toctree-l2"><a class="reference internal" href="tips.html#importance-of-numerical-quality-of-force-constants">Importance of numerical quality of force constants</a></li>
<li class="toctree-l2"><a class="reference internal" href="tips.html#file-format-compatibility-with-phonopy">File format compatibility with phonopy</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="citation.html">How to cite phono3py</a><ul>
<li class="toctree-l2"><a class="reference internal" href="citation.html#citation-of-phono3py">Citation of phono3py</a></li>
<li class="toctree-l2"><a class="reference internal" href="citation.html#citation-of-direct-solution-of-lbte-lbte">Citation of direct solution of LBTE (<code class="docutils literal notranslate"><span class="pre">--lbte</span></code>)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Change Log</a><ul>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#mar-17-2021-version-1-22-3">Mar-17-2021: Version 1.22.3</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#feb-21-2021-version-1-22-2">Feb-21-2021: Version 1.22.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#feb-21-2021-version-1-22-1">Feb-21-2021: Version 1.22.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#jan-29-2021-version-1-22-0">Jan-29-2021: Version 1.22.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#sep-30-2020-version-1-21-0">Sep-30-2020: Version 1.21.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#mar-3-2020-version-1-20-0">Mar-3-2020: Version 1.20.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#mar-3-2020-version-1-19-1">Mar-3-2020: Version 1.19.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#mar-2-2020-version-1-19-0">Mar-2-2020: Version 1.19.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#dec-22-2019-version-1-18-2">Dec-22-2019: Version 1.18.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#oct-17-2019-version-1-18-1">Oct-17-2019: Version 1.18.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#oct-9-2019-version-1-18-0">Oct-9-2019: Version 1.18.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#apr-18-2019-version-1-17-0">Apr-18-2019: Version 1.17.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#mar-24-2019-version-1-16-0">Mar-24-2019: Version 1.16.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#nov-22-2018-version-1-14-3">Nov-22-2018: version 1.14.3</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#june-20-2018-version-1-13-3">June-20-2018: version 1.13.3</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#may-17-2018-version-1-13-1">May-17-2018: version 1.13.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#mar-16-2018-version-1-12-9">Mar-16-2018: version 1.12.9</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#feb-1-2018-version-1-12-7">Feb-1-2018: version 1.12.7</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#nov-22-2017-version-1-12-5">Nov-22-2017: version 1.12.5</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#nov-17-2017-version-1-12-3">Nov-17-2017: version 1.12.3</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#jun-18-2017-version-1-11-13">Jun-18-2017: version 1.11.13</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#mar-31-2017-version-1-11-11">Mar-31-2017: version 1.11.11</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#feb-9-2017-version-1-11-9">Feb-9-2017: version 1.11.9</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#dec-14-2016-version-1-11-7">Dec-14-2016: version 1.11.7</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#nov-27-2016-version-1-11-5">Nov-27-2016: version 1.11.5</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#apr-24-2016-version-1-10-9">Apr-24-2016: version 1.10.9</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#apr-16-2016-version-1-10-7">Apr-16-2016: version 1.10.7</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#mar-15-2016-version-1-10-5">Mar-15-2016: version 1.10.5</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#oct-10-2015-version-0-9-14">Oct-10-2015: version 0.9.14</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#sep-26-2015-version-0-9-13">Sep-26-2015: version 0.9.13</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#aug-12-2015-version-0-9-12">Aug-12-2015: version 0.9.12</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#jun-18-2015-version-0-9-10-1">Jun-18-2015: version 0.9.10.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#jun-17-2015-version-0-9-10">Jun-17-2015: version 0.9.10</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#changes-in-version-0-9-7">Changes in version 0.9.7</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#changes-in-version-0-9-6">Changes in version 0.9.6</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#changes-in-version-0-9-5">Changes in version 0.9.5</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#changes-in-version-0-9-4">Changes in version 0.9.4</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#changes-in-version-0-8-11">Changes in version 0.8.11</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#changes-in-version-0-8-10">Changes in version 0.8.10</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#changes-in-version-0-8-2">Changes in version 0.8.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#changes-in-version-0-8-0">Changes in version 0.8.0</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#changes-in-version-0-7-6">Changes in version 0.7.6</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#changes-in-version-0-7-2">Changes in version 0.7.2</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#changes-in-version-0-7-1">Changes in version 0.7.1</a></li>
<li class="toctree-l2"><a class="reference internal" href="changelog.html#changes-in-version-0-6-0">Changes in version 0.6.0</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Installation</a><ul>
<li><a class="reference internal" href="#installation-using-conda">Installation using conda</a></li>
<li><a class="reference internal" href="#installation-using-pip-is-not-recommended">Installation using pip is not recommended</a></li>
<li><a class="reference internal" href="#installation-from-source-code">Installation from source code</a><ul>
<li><a class="reference internal" href="#installation-of-lapacke">Installation of LAPACKE</a><ul>
<li><a class="reference internal" href="#mkl-lapacke-with-multithread-blas">MKL LAPACKE (with multithread BLAS)</a></li>
<li><a class="reference internal" href="#openblas-provided-by-conda-with-multithread-blas">OpenBLAS provided by conda (with multithread BLAS)</a></li>
<li><a class="reference internal" href="#netlib-lapacke-provided-by-ubuntu-package-manager-with-single-thread-blas">Netlib LAPACKE provided by Ubuntu package manager (with single-thread BLAS)</a></li>
<li><a class="reference internal" href="#compiling-netlib-lapacke">Compiling Netlib LAPACKE</a></li>
</ul>
</li>
<li><a class="reference internal" href="#building-using-setup-py">Building using setup.py</a></li>
</ul>
</li>
<li><a class="reference internal" href="#installation-instruction-of-latest-development-version-of-phono3py">Installation instruction of latest development version of phono3py</a></li>
<li><a class="reference internal" href="#multithreading-and-its-controlling-by-c-macro">Multithreading and its controlling by C macro</a></li>
<li><a class="reference internal" href="#trouble-shooting">Trouble shooting</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="index.html" title="Previous Chapter: Welcome to phono3py"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Welcome to phono3py</span>
    </a>
  </li>
  <li>
    <a href="examples.html" title="Next Chapter: Examples"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">Examples &raquo;</span>
    </a>
  </li>
              
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <div class="section" id="installation">
<span id="install"></span><h1>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h1>
<p>The detailed installation processes for different environments
are described below. The easiest installation with a good computation
performance is achieved by using the phono3py conda package (see
<a class="reference internal" href="#install-an-example"><span class="std std-ref">Installation instruction of latest development version of phono3py</span></a>).</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#installation-using-conda" id="id1">Installation using conda</a></p></li>
<li><p><a class="reference internal" href="#installation-using-pip-is-not-recommended" id="id2">Installation using pip is not recommended</a></p></li>
<li><p><a class="reference internal" href="#installation-from-source-code" id="id3">Installation from source code</a></p>
<ul>
<li><p><a class="reference internal" href="#installation-of-lapacke" id="id4">Installation of LAPACKE</a></p>
<ul>
<li><p><a class="reference internal" href="#mkl-lapacke-with-multithread-blas" id="id5">MKL LAPACKE (with multithread BLAS)</a></p></li>
<li><p><a class="reference internal" href="#openblas-provided-by-conda-with-multithread-blas" id="id6">OpenBLAS provided by conda (with multithread BLAS)</a></p></li>
<li><p><a class="reference internal" href="#netlib-lapacke-provided-by-ubuntu-package-manager-with-single-thread-blas" id="id7">Netlib LAPACKE provided by Ubuntu package manager (with single-thread BLAS)</a></p></li>
<li><p><a class="reference internal" href="#compiling-netlib-lapacke" id="id8">Compiling Netlib LAPACKE</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#building-using-setup-py" id="id9">Building using setup.py</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#installation-instruction-of-latest-development-version-of-phono3py" id="id10">Installation instruction of latest development version of phono3py</a></p></li>
<li><p><a class="reference internal" href="#multithreading-and-its-controlling-by-c-macro" id="id11">Multithreading and its controlling by C macro</a></p></li>
<li><p><a class="reference internal" href="#trouble-shooting" id="id12">Trouble shooting</a></p></li>
</ul>
</div>
<p>Installation of phonopy before the installation of phono3py is
required. See how to install phonopy at
<a class="reference external" href="https://phonopy.github.io/phonopy/install.html">https://phonopy.github.io/phonopy/install.html</a>. Phono3py relies on
phonopy, so please use the latest release of phonopy when installing
phono3py.</p>
<div class="section" id="installation-using-conda">
<h2><a class="toc-backref" href="#id1">Installation using conda</a><a class="headerlink" href="#installation-using-conda" title="Permalink to this headline">¶</a></h2>
<p>Using conda is the easiest way for installation of phono3py if you are
using x86-64 linux system or macOS. These packages are made and
maintained by Jan Janssen. The installation is simply done by:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">conda</span> <span class="n">install</span> <span class="o">-</span><span class="n">c</span> <span class="n">conda</span><span class="o">-</span><span class="n">forge</span> <span class="n">phono3py</span>
</pre></div>
</div>
<p>All dependent packages should be installed.</p>
</div>
<div class="section" id="installation-using-pip-is-not-recommended">
<h2><a class="toc-backref" href="#id2">Installation using pip is not recommended</a><a class="headerlink" href="#installation-using-pip-is-not-recommended" title="Permalink to this headline">¶</a></h2>
<p>PyPI packages are prepared for phonopy and phono3py releases. When
installing with PyPI, <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> is executed locally to compile the
part of the code written in C, so a few libraries such as
lapacke must exist in the system. Those necessary libraries are
explained in the next section.</p>
</div>
<div class="section" id="installation-from-source-code">
<h2><a class="toc-backref" href="#id3">Installation from source code</a><a class="headerlink" href="#installation-from-source-code" title="Permalink to this headline">¶</a></h2>
<p>When installing phono3py using <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> from the source code, a
few libraries are required before running <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> script.</p>
<p>For phono3py, OpenMP library is necessary for the multithreding
support. In additon, BLAS, LAPACK, and LAPACKE are also needed. These
packages are probably installed using the package manager for each OS
or conda.</p>
<p>When using gcc to compile phono3py, <code class="docutils literal notranslate"><span class="pre">libgomp1</span></code> is necessary to
enable OpenMP multithreading support. This library is probably
installed already in your system. If you don’t have it and you use
Ubuntu linux, it is installed by:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">libgomp1</span>
</pre></div>
</div>
<div class="section" id="installation-of-lapacke">
<span id="install-lapacke"></span><h3><a class="toc-backref" href="#id4">Installation of LAPACKE</a><a class="headerlink" href="#installation-of-lapacke" title="Permalink to this headline">¶</a></h3>
<p>LAPACK library is used in a few parts of the code to diagonalize
matrices. LAPACK*E* is the C-wrapper of LAPACK and LAPACK relies on
BLAS. Both single-thread or multithread BLAS can be
used in phono3py. In the following, multiple different ways of
installation of LAPACKE are explained.</p>
<div class="section" id="mkl-lapacke-with-multithread-blas">
<span id="install-mkl-lapacke"></span><h4><a class="toc-backref" href="#id5">MKL LAPACKE (with multithread BLAS)</a><a class="headerlink" href="#mkl-lapacke-with-multithread-blas" title="Permalink to this headline">¶</a></h4>
<p>Phono3py can be compiled with MKL for using LAPACKE.  If <code class="docutils literal notranslate"><span class="pre">setup.py</span></code>
finds the file named <code class="docutils literal notranslate"><span class="pre">setup_mkl.py</span></code>, the contents of <code class="docutils literal notranslate"><span class="pre">setup_mkl.py</span></code> is read
and those are included in the compilation setting.  For example, the
following setting prepared as <code class="docutils literal notranslate"><span class="pre">setup_mkl.py</span></code> seems working on Ubuntu 16.04
system:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">intel_root</span> <span class="o">=</span> <span class="s2">&quot;/opt/intel/composer_xe_2015.7.235&quot;</span>
<span class="n">mkl_root</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">/mkl&quot;</span> <span class="o">%</span> <span class="n">intel_root</span>
<span class="n">compiler_root</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">/compiler&quot;</span> <span class="o">%</span> <span class="n">intel_root</span>

<span class="n">mkl_extra_link_args_lapacke</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;-L</span><span class="si">%s</span><span class="s1">/lib/intel64&#39;</span> <span class="o">%</span> <span class="n">mkl_root</span><span class="p">,</span>
                               <span class="s1">&#39;-lmkl_rt&#39;</span><span class="p">]</span>
<span class="n">mkl_extra_link_args_lapacke</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;-L</span><span class="si">%s</span><span class="s1">/lib/intel64&#39;</span> <span class="o">%</span> <span class="n">compiler_root</span><span class="p">,</span>
                                <span class="s1">&#39;-lsvml&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;-liomp5&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;-limf&#39;</span><span class="p">,</span>
                                <span class="s1">&#39;-lpthread&#39;</span><span class="p">]</span>
<span class="n">mkl_include_dirs_lapacke</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">/include&quot;</span> <span class="o">%</span> <span class="n">mkl_root</span><span class="p">]</span>
</pre></div>
</div>
<p>This setting considers to use <code class="docutils literal notranslate"><span class="pre">icc</span></code> but it may be compiled with
<code class="docutils literal notranslate"><span class="pre">gcc</span></code>. With <code class="docutils literal notranslate"><span class="pre">gcc</span></code>, the compiler related setting shown above (i.e.,
around <code class="docutils literal notranslate"><span class="pre">compiler_root</span></code>) is unnecessary. To achieve this
installation, not only the MKL library but also the header file are
necessary. The libraries are linked dynamically, so in most of the
cases, <code class="docutils literal notranslate"><span class="pre">LD_LIBRARY_PATH</span></code> environment variable has to be correctly
specified to let phono3py find those libraries.</p>
</div>
<div class="section" id="openblas-provided-by-conda-with-multithread-blas">
<span id="install-openblas-lapacke"></span><h4><a class="toc-backref" href="#id6">OpenBLAS provided by conda (with multithread BLAS)</a><a class="headerlink" href="#openblas-provided-by-conda-with-multithread-blas" title="Permalink to this headline">¶</a></h4>
<p>The installtion of LAPACKE is easy by conda. It is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">conda</span> <span class="n">install</span> <span class="o">-</span><span class="n">c</span> <span class="n">conda</span><span class="o">-</span><span class="n">forge</span> <span class="n">openblas</span> <span class="n">libgfortran</span>
</pre></div>
</div>
<p>The recent change of openblas package provided from anaconda makes to
install nomkl, i.e., numpy and scipy with Intel MKL cannot be used
together with openblas. At this moment, this is avoided to install
openblas from conda-forge channel. If the python libraries are not yet
installed:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">conda</span> <span class="n">install</span> <span class="o">-</span><span class="n">c</span> <span class="n">conda</span><span class="o">-</span><span class="n">forge</span> <span class="n">numpy</span> <span class="n">scipy</span> <span class="n">h5py</span> <span class="n">pyyaml</span> <span class="n">matplotlib</span>
</pre></div>
</div>
<p>Note that using hdf5 files on NFS mouted file system, you may have to
disable file locking by setting</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">export</span> <span class="n">HDF5_USE_FILE_LOCKING</span><span class="o">=</span><span class="n">FALSE</span>
</pre></div>
</div>
<p>This openblas package contains BLAS, LAPACK, and LAPACKE. When this
<code class="docutils literal notranslate"><span class="pre">libopenblas</span></code> is linked and the <code class="docutils literal notranslate"><span class="pre">else</span></code> statement of the C macro
definition section in <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> is executed, the following macro
are activated:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">use_setuptools</span><span class="p">:</span>
    <span class="n">extra_compile_args</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;-DMULTITHREADED_BLAS&#39;</span><span class="p">]</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">define_macros</span> <span class="o">+=</span> <span class="p">[(</span><span class="s1">&#39;MULTITHREADED_BLAS&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)]</span>
</pre></div>
</div>
<p>Libraries or headers are not found at the build by <code class="docutils literal notranslate"><span class="pre">setup.py</span></code>, the
following setting may be of the help:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">extra_link_args_lapacke</span> <span class="o">+=</span> <span class="p">[</span><span class="s1">&#39;-lopenblas&#39;</span><span class="p">,</span> <span class="s1">&#39;-lgfortran&#39;</span><span class="p">]</span>
<span class="n">include_dirs_lapacke</span> <span class="o">+=</span> <span class="p">[</span>
    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;CONDA_PREFIX&#39;</span><span class="p">],</span> <span class="s1">&#39;include&#39;</span><span class="p">),</span> <span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="netlib-lapacke-provided-by-ubuntu-package-manager-with-single-thread-blas">
<h4><a class="toc-backref" href="#id7">Netlib LAPACKE provided by Ubuntu package manager (with single-thread BLAS)</a><a class="headerlink" href="#netlib-lapacke-provided-by-ubuntu-package-manager-with-single-thread-blas" title="Permalink to this headline">¶</a></h4>
<p>In the versions of Ubuntu-12.10 or later, LAPACKE
(<a class="reference external" href="http://www.netlib.org/lapack/lapacke.html">http://www.netlib.org/lapack/lapacke.html</a>) can be installed from the
package manager (<code class="docutils literal notranslate"><span class="pre">liblapacke</span></code> and <code class="docutils literal notranslate"><span class="pre">liblapacke-dev</span></code>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">liblapack</span><span class="o">-</span><span class="n">dev</span> <span class="n">liblapacke</span><span class="o">-</span><span class="n">dev</span>
</pre></div>
</div>
</div>
<div class="section" id="compiling-netlib-lapacke">
<h4><a class="toc-backref" href="#id8">Compiling Netlib LAPACKE</a><a class="headerlink" href="#compiling-netlib-lapacke" title="Permalink to this headline">¶</a></h4>
<p>The compilation procedure is found at the LAPACKE web site. After
creating the LAPACKE library, <code class="docutils literal notranslate"><span class="pre">liblapacke.a</span></code> (or the dynamic link
library), <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> must be properly modified to link it. As an
example, the procedure of compiling LAPACKE is shown below.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">tar</span> <span class="n">xvfz</span> <span class="n">lapack</span><span class="o">-</span><span class="mf">3.6</span><span class="o">.</span><span class="mf">0.</span><span class="n">tgz</span>
<span class="o">%</span> <span class="n">cd</span> <span class="n">lapack</span><span class="o">-</span><span class="mf">3.6</span><span class="o">.</span><span class="mi">0</span>
<span class="o">%</span> <span class="n">cp</span> <span class="n">make</span><span class="o">.</span><span class="n">inc</span><span class="o">.</span><span class="n">example</span> <span class="n">make</span><span class="o">.</span><span class="n">inc</span>
<span class="o">%</span> <span class="n">make</span> <span class="n">lapackelib</span>
</pre></div>
</div>
<p>BLAS, LAPACK, and LAPACKE, these all may have to be compiled
with <code class="docutils literal notranslate"><span class="pre">-fPIC</span></code> option to use it with python.</p>
</div>
</div>
<div class="section" id="building-using-setup-py">
<h3><a class="toc-backref" href="#id9">Building using setup.py</a><a class="headerlink" href="#building-using-setup-py" title="Permalink to this headline">¶</a></h3>
<p>If package installation is not possible or you want to compile with
special compiler or special options, phono3py is built using
setup.py. In this case, manual modification of <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> may be
needed.</p>
<ol class="arabic">
<li><p>Download the latest source code at</p>
<p><a class="reference external" href="https://pypi.python.org/pypi/phono3py">https://pypi.python.org/pypi/phono3py</a></p>
</li>
<li><p>and extract it:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">tar</span> <span class="n">xvfz</span> <span class="n">phono3py</span><span class="o">-</span><span class="mf">1.11</span><span class="o">.</span><span class="mf">13.39</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span>
<span class="o">%</span> <span class="n">cd</span> <span class="n">phono3py</span><span class="o">-</span><span class="mf">1.11</span><span class="o">.</span><span class="mf">13.39</span>
</pre></div>
</div>
<p>The other option is using git to clone the phonopy repository from github:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">phonopy</span><span class="o">/</span><span class="n">phono3py</span><span class="o">.</span><span class="n">git</span>
<span class="o">%</span> <span class="n">cd</span> <span class="n">phono3py</span>
</pre></div>
</div>
</li>
</ol>
<ol class="arabic" start="2">
<li><p>Set up C-libraries for python C-API and python codes. This can be
done as follows:</p>
<p>Run <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> script via pip:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">e</span> <span class="o">.</span>
</pre></div>
</div>
</li>
<li><p>Set <span class="target" id="index-0"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">$PATH</span></code> and <span class="target" id="index-1"></span><code class="xref std std-envvar docutils literal notranslate"><span class="pre">$PYTHONPATH</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">PATH</span></code> and <code class="docutils literal notranslate"><span class="pre">PYTHONPATH</span></code> are set in the same way as phonopy, see
<a class="reference external" href="https://phonopy.github.io/phonopy/install.html#building-using-setup-py">https://phonopy.github.io/phonopy/install.html#building-using-setup-py</a>.</p>
</li>
</ol>
</div>
</div>
<div class="section" id="installation-instruction-of-latest-development-version-of-phono3py">
<span id="install-an-example"></span><h2><a class="toc-backref" href="#id10">Installation instruction of latest development version of phono3py</a><a class="headerlink" href="#installation-instruction-of-latest-development-version-of-phono3py" title="Permalink to this headline">¶</a></h2>
<p>When using conda, <code class="docutils literal notranslate"><span class="pre">PYTHONPATH</span></code> should not be set if possible because
potentially wrong python libraries can be imported.</p>
<p>This installation instruction supposes linux x86-64 environment.</p>
<ol class="arabic">
<li><p>Download miniconda package</p>
<p>Miniconda is downloaded at <a class="reference external" href="https://conda.io/miniconda.html">https://conda.io/miniconda.html</a>.</p>
<p>For usual 64-bit Linux system:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">wget</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">repo</span><span class="o">.</span><span class="n">anaconda</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">miniconda</span><span class="o">/</span><span class="n">Miniconda3</span><span class="o">-</span><span class="n">latest</span><span class="o">-</span><span class="n">Linux</span><span class="o">-</span><span class="n">x86_64</span><span class="o">.</span><span class="n">sh</span> <span class="o">-</span><span class="n">O</span> <span class="o">~/</span><span class="n">miniconda</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
<p>For macOS:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">wget</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">repo</span><span class="o">.</span><span class="n">anaconda</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">miniconda</span><span class="o">/</span><span class="n">Miniconda3</span><span class="o">-</span><span class="n">latest</span><span class="o">-</span><span class="n">MacOSX</span><span class="o">-</span><span class="n">x86_64</span><span class="o">.</span><span class="n">sh</span> <span class="o">-</span><span class="n">O</span> <span class="o">~/</span><span class="n">miniconda</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
<p>The installation is made by</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>% bash ~/miniconda.sh -b -p $HOME/miniconda
% export PATH=&quot;$HOME/miniconda/bin:$PATH&quot;
</pre></div>
</div>
<p>The detailed installation instruction is found at
<a class="reference external" href="https://conda.io/projects/conda/en/latest/user-guide/install/index.html">https://conda.io/projects/conda/en/latest/user-guide/install/index.html</a>. To
use the conda-forge channel as the default one, <code class="docutils literal notranslate"><span class="pre">~/.condarc</span></code> may be
written following the conda-forge official documentation
(<a class="reference external" href="https://conda-forge.org/docs/user/tipsandtricks.html">https://conda-forge.org/docs/user/tipsandtricks.html</a>).</p>
</li>
<li><p>Initialization of conda and setup of conda environment</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">conda</span> <span class="n">init</span> <span class="o">&lt;</span><span class="n">your_shell</span><span class="o">&gt;</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">&lt;your_shell&gt;</span></code> is often <code class="docutils literal notranslate"><span class="pre">bash</span></code> but may be something else. It is
important that after running <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">init</span></code>, your shell is needed
to be closed and restarted. See more information by <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">init</span>
<span class="pre">--help</span></code>.</p>
<p>Then conda allows to make conda installation isolated by using conda’s
virtual environment.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">conda</span> <span class="n">create</span> <span class="o">-</span><span class="n">n</span> <span class="n">phono3py</span> <span class="o">-</span><span class="n">c</span> <span class="n">conda</span><span class="o">-</span><span class="n">forge</span> <span class="n">python</span><span class="o">=</span><span class="mf">3.8</span>
<span class="o">%</span> <span class="n">conda</span> <span class="n">activate</span> <span class="n">phono3py</span>
</pre></div>
</div>
<p>Use of this is strongly recommended, otherwise proper settings of
<code class="docutils literal notranslate"><span class="pre">CONDA_PREFIX</span></code>, <code class="docutils literal notranslate"><span class="pre">C_INCLUDE_PATH</span></code>, and <code class="docutils literal notranslate"><span class="pre">LD_LIBRARY_PATH</span></code> will
be necessary.</p>
</li>
</ol>
<ol class="arabic" start="2">
<li><p>Install necessary conda packages for phono3py</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">conda</span> <span class="n">install</span> <span class="o">-</span><span class="n">c</span> <span class="n">conda</span><span class="o">-</span><span class="n">forge</span> <span class="n">numpy</span> <span class="n">scipy</span> <span class="n">h5py</span> <span class="n">pyyaml</span> <span class="n">matplotlib</span><span class="o">-</span><span class="n">base</span> <span class="n">compilers</span> <span class="s2">&quot;libblas=*=*mkl&quot;</span> <span class="n">spglib</span> <span class="n">mkl</span><span class="o">-</span><span class="n">include</span>
</pre></div>
</div>
<p>Note that using hdf5 files on NFS mouted file system, you may have to
disable file locking by setting</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">export</span> <span class="n">HDF5_USE_FILE_LOCKING</span><span class="o">=</span><span class="n">FALSE</span>
</pre></div>
</div>
<p>Install the latest phonopy and phono3py from github sources:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">mkdir</span> <span class="n">dev</span>
<span class="o">%</span> <span class="n">cd</span> <span class="n">dev</span>
<span class="o">%</span> <span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">phonopy</span><span class="o">/</span><span class="n">phonopy</span><span class="o">.</span><span class="n">git</span>
<span class="o">%</span> <span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">phonopy</span><span class="o">/</span><span class="n">phono3py</span><span class="o">.</span><span class="n">git</span>
<span class="o">%</span> <span class="n">cd</span> <span class="n">phonopy</span>
<span class="o">%</span> <span class="n">git</span> <span class="n">checkout</span> <span class="n">develop</span>
<span class="o">%</span> <span class="n">python</span> <span class="n">setup</span><span class="o">.</span><span class="n">py</span> <span class="n">build</span>
<span class="o">%</span> <span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">e</span> <span class="o">.</span>
<span class="o">%</span> <span class="n">cd</span> <span class="o">../</span><span class="n">phono3py</span>
<span class="o">%</span> <span class="n">git</span> <span class="n">checkout</span> <span class="n">develop</span>
<span class="o">%</span> <span class="n">python</span> <span class="n">setup</span><span class="o">.</span><span class="n">py</span> <span class="n">build</span>
<span class="o">%</span> <span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">e</span> <span class="o">.</span>
</pre></div>
</div>
<p>The conda packages dependency can often change and this recipe may
not work properly. So if you find this instruction doesn’t work, it
is very appreciated if letting us know it in the phonopy mailing
list.</p>
</li>
</ol>
</div>
<div class="section" id="multithreading-and-its-controlling-by-c-macro">
<h2><a class="toc-backref" href="#id11">Multithreading and its controlling by C macro</a><a class="headerlink" href="#multithreading-and-its-controlling-by-c-macro" title="Permalink to this headline">¶</a></h2>
<p>Phono3py uses multithreading concurrency in two ways. One is that
written in the code with OpenMP <code class="docutils literal notranslate"><span class="pre">parallel</span> <span class="pre">for</span></code>. The other is
achieved by using multithreaded BLAS. The BLAS multithreading is
depending on which BLAS library is chosen by users and the number of
threads to be used may be controlled by the library’s environment
variables (e.g., <code class="docutils literal notranslate"><span class="pre">OPENBLAS_NUM_THREADS</span></code> or <code class="docutils literal notranslate"><span class="pre">MKL_NUM_THREADS</span></code>). In
the phono3py C code, these two are written in a nested way, but of
course the nested use of multiple multithreadings has to be
avoided. The outer loop of the nesting is done by the OpenMP
<code class="docutils literal notranslate"><span class="pre">parallel</span> <span class="pre">for</span></code> code. The inner loop calls LAPACKE functions and then
the LAPACKE functions call the BLAS routines. If both of the inner and
outer multithreadings can be activated, the inner multithreading must
be deactivated at the compilation time. This is achieved by setting
the C macro <code class="docutils literal notranslate"><span class="pre">MULTITHREADED_BLAS</span></code>, which can be written in
<code class="docutils literal notranslate"><span class="pre">setup.py</span></code>. Deactivating the multithreading of BLAS using the
environment variables is not recommended because it is used in the
non-nested parts of the code and these multithreadings are
unnecessary to be deactivated.</p>
</div>
<div class="section" id="trouble-shooting">
<h2><a class="toc-backref" href="#id12">Trouble shooting</a><a class="headerlink" href="#trouble-shooting" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li><p>Phonopy version should be the latest to use the latest phono3py.</p></li>
<li><p>There are other pitfalls, see
<a class="reference external" href="https://phonopy.github.io/phonopy/install.html#trouble-shooting">https://phonopy.github.io/phonopy/install.html#trouble-shooting</a>.</p></li>
</ol>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
<div id="sourcelink">
  <a href="_sources/install.rst.txt"
     rel="nofollow">Source</a>
</div>
      
    </p>
    <p>
        &copy; Copyright 2015, Atsushi Togo.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.5.4.<br/>
    </p>
  </div>
</footer>
  </body>
</html>